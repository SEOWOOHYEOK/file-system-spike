# External Access ✅

# 4. External Access

## 4.1 개요

External Access는 외부 공유 권한을 기반으로

공유된 파일에 접근할 수 있도록 제공되는 접근 기능이다.

External Access는 외부 시스템에서 이미 생성된

Guest 계정(guestId) 또는 내부 사용자(User) 계정을 기반으로 인증을 수행하며,

인증 이후의 파일 접근 흐름은 파일 관리 모듈의 user, manager, admin 권한과 별도로 동작하며,

공유 시 부여된 파일 접근 권한과 동일하게 동작한다.

본 기능은 외부 협업 및 파일 전달을 지원하기 위해 제공되며,

내부 시스템의 보안 정책을 유지하면서

공유 권한이 부여된 파일에 한해서만 접근을 허용하는 것을 목표로 한다.

External Access는 파일 관리 모듈의 직접적인 하위 기능이 아니며,

외부 공유 권한을 매개로 동작하는 **독립적인 접근 경로**로 정의한다.

---

## 4.2 접근 대상 및 범위

External Access의 접근 대상은 다음과 같다.

- 외부 공유 권한이 부여된 파일
- 공유 권한이 **ACTIVE 상태**인 경우에 한해 접근 가능
- 유효한 사용자 식별자(userId 또는 guestId)를 보유한 사용자

접근 권한을 부여받은 사용자는 다음 기능만 제한적으로 수행할 수 있다.

| 기능 | 가능 여부 |
| --- | --- |
| 파일 메타 정보 조회 | O |
| 파일 미리보기 | 조건부 |
| 파일 다운로드 | 조건부 |
| 파일 목록 탐색 | X |
| 파일 수정 / 삭제 | X |

※ 접근 가능 여부는 사용자 유형이 아닌 **공유 권한 상태**를 기준으로 판단한다.

---

## 4.3 접근 절차 개요

External Access는 인증(로그인) 완료 이후 접근 흐름을 전제로 한다.

접근 권한을 부여받은 사용자가 External Access 경로를 통해 접근할 때의 기본 절차는 다음과 같다.

1. 사용자가 External Access 경로로 접근한다.
2. 사용자 계정에 연결된 공유 권한 정보를 조회한다.
3. 공유 권한 상태 및 대상 파일 상태를 확인한다.
4. 접근 가능 여부에 따라 접근 허용 또는 차단 응답을 제공한다.

---

## 4.4 접근 검증 항목

External Access 접근 시 다음 항목을 순차적으로 검증한다.

### 4.4.1 인증 상태(세션) 확인

- External Access는 인증(로그인) 완료 이후의 접근을 전제로 한다.
- userId 또는 guestId의 유효성은 인증 계층에서 검증되며,
본 기능에서는 별도로 검증하지 않는다.
- 인증되지 않은 요청은 접근 차단 응답을 제공한다.

---

### 4.4.2 공유 권한 검증

- 공유 권한 상태 확인
    - ACTIVE: 접근 가능
    - EXPIRED / REVOKED: 접근 차단
- 공유는 **파일**만 가능

---

### 4.4.3 파일 상태 검증

- 파일이 ACTIVE 상태인 경우에만 접근 가능
- 파일이 DELETED 또는 REMOVED 상태인 경우 접근을 차단한다.

※ 사용자에게는 파일이 현재 이용할 수 없는 상태이며 담당자에게 문의하라고 알림을 보여준다.

---

## 4.5 파일 정보 조회 정책

접근이 허용된 경우, 사용자는 다음 파일 정보를 확인할 수 있다.

- 파일명
- 파일 크기
- 생성 일시
- 다운로드 제한 정보

파일의 내부 경로, 프로젝트 정보 등

**내부 시스템 구조 정보는 노출하지 않는다.**

---

## 4.6 미리보기 접근 정책

- 공유 권한에 `미리보기 가능` 설정이 활성화된 경우에만 미리보기를 허용한다.
- 미리보기 권한이 없는 경우, 페이지는 유지하되 미리보기 기능만 차단한다.
- 미리보기를 지원하지 않는 파일 형식의 경우, 다운로드로 유도한다.

---

## 4.7 다운로드 접근 정책

### 4.7.1 다운로드 허용 조건

- 공유 권한이 ACTIVE 상태일 것
- 다운로드 가능 설정이 활성화되어 있을 것
- 다운로드 횟수 제한이 남아 있을 것

---

### 4.7.2 다운로드 횟수 차감

- 다운로드 완료 시 해당 파일의 다운로드 횟수를 1회 차감한다.
- 다중 파일 다운로드 시, 각 파일에 대해 개별적으로 횟수를 차감한다.

---

### 4.7.3 다운로드 차단

- 다운로드 제한을 초과한 경우, 다운로드를 차단한다.
- 차단 시 페이지는 유지되며, 다운로드 불가 안내 메시지를 표시한다.

---

## 4.8 접근 실패 응답 정책

External Access에서 접근이 차단되는 경우,

사용자에게는 **접근 차단 사유를 상세히 노출하지 않는다.**

### 접근 차단 사유 예시

- 인증되지 않은 요청(세션 없음)
- 공유 권한이 만료 또는 회수된 경우
- 파일이 삭제 또는 영구 삭제된 경우

위 모든 경우에 대해 **동일한 접근 차단 응답**을 제공한다.

### 접근 차단 응답 원칙

- 파일 정보 및 존재 여부를 노출하지 않는다.
- 내부 상태 및 권한 정보를 외부에 공개하지 않는다.

---

## 4.9 오류 처리 및 예외 상황

- 네트워크 또는 시스템 오류 발생 시, 오류 안내 메시지와 함께 재시도를 안내한다.
- 일시적인 시스템 오류와 접근 권한 차단은 명확히 구분하여 안내한다.
- 모든 External Access 접근 및 실패 이력은 로그로 기록된다.

---

## 4.10 보안 및 감사 정책

- External Access 요청은 전부 감사 로그 대상으로 기록한다.
- 사용자 식별자 기반 접근은 추적 가능해야 하며, 필요 시 접근 이력 조회를 지원한다.
- 비정상적인 접근 시도는 보안 정책에 따라 추가 대응이 가능하도록 설계한다.

---

### ✅ 4장 요약 (수정)

- External Access는 인증(로그인) 완료 이후의 접근을 전제로 한다.
- External Access는 **공유 권한 기반 접근 경로**이다.
- 내부 사용자(User)와 외부 사용자(Guest)는 **동일한 접근 흐름**을 따른다.
- 접근 허용 여부는 **사용자 유형이 아닌 공유 권한 상태**를 기준으로 판단한다.
- 접근 실패 시, 사유를 구체적으로 노출하지 않는다.