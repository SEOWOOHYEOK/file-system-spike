# 011. 대외 공유 API 플로우

---

## 개요

이 문서는 [010.대외 공유.md](./010.대외%20공유.md)에 정의된 API 엔드포인트별 상세 처리 플로우를 정리합니다.

---

## 목차

1. [내부 사용자 API](#1-내부-사용자-api)
2. [게스트 API](#2-게스트-api)
3. [관리자 API](#3-관리자-api)

---

# 1. 내부 사용자 API

## 1-1. POST /api/shares - 공유 링크 생성

### Request

```typescript
interface CreateShareRequest {
  resourceType: 'FILE' | 'FOLDER';
  resourceId: string;               // 파일 또는 폴더 ID
  title: string;                    // 공유 제목
  description?: string;             // 공유 설명
  
  // 접근 제어
  accessType: 'PUBLIC' | 'PROTECTED' | 'PRIVATE';
  password?: string;                // PROTECTED인 경우 필수
  
  // 기간 제어
  startsAt?: string;                // ISO 8601, 기본값: 즉시
  expiresAt?: string;               // ISO 8601, 필수
  
  // 다운로드 제어
  maxDownloads?: number;            // NULL = 무제한
  
  // 추가 제어
  allowPreview?: boolean;           // 기본값: true
  allowDownload?: boolean;          // 기본값: true
  allowedIpRanges?: string[];       // IP 범위 제한 (옵션)
}
```

### Response

```typescript
interface CreateShareResponse {
  id: string;
  shareCode: string;
  shareUrl: string;                 // 전체 공유 URL
  resourceType: 'FILE' | 'FOLDER';
  resourceId: string;
  title: string;
  accessType: 'PUBLIC' | 'PROTECTED' | 'PRIVATE';
  startsAt: string;
  expiresAt: string;
  maxDownloads: number | null;
  status: 'ACTIVE';
  createdAt: string;
}
```

### 처리 플로우

```
┌─────────────────────────────────────────────────────────────────────────┐
│  [POST /api/shares 처리 플로우]                                           │
│                                                                         │
│  1. 인증 확인                                                            │
│     └─ JwtAuthGuard → userId 추출                                       │
│                                                                         │
│  2. 입력 유효성 검사                                                     │
│     ├─ resourceType, resourceId 필수                                    │
│     ├─ expiresAt 필수 (미래 시간)                                       │
│     └─ PROTECTED인 경우 password 필수                                   │
│                                                                         │
│  3. 리소스 권한 확인                                                     │
│     ├─ 파일/폴더 존재 여부                                               │
│     └─ 사용자의 접근 권한 확인                                           │
│                                                                         │
│  4. 공유 정책 검증                                                       │
│     ├─ 최대 공유 기간 (defaultMaxDays)                                  │
│     ├─ 사용자당 공유 한도 (maxSharesPerUser)                            │
│     ├─ 파일 크기 제한 (maxFileSizeBytes)                                │
│     ├─ 허용/차단 파일 타입                                               │
│     └─ PUBLIC 공유 허용 여부                                             │
│                                                                         │
│  5. shareCode 생성                                                      │
│     └─ UUID 또는 nanoid (충돌 방지)                                     │
│                                                                         │
│  6. DB 트랜잭션                                                          │
│     ├─ share_links INSERT                                               │
│     └─ (PROTECTED) password bcrypt 해싱                                 │
│                                                                         │
│  7. 응답 반환                                                            │
│     └─ shareUrl = `${baseUrl}/s/${shareCode}`                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### SQL

```sql
-- 정책 조회
SELECT * FROM share_policies WHERE isActive = true LIMIT 1;

-- 사용자 공유 수 확인
SELECT COUNT(*) as shareCount 
FROM share_links 
WHERE createdBy = :userId AND status != 'DELETED';

-- 리소스 존재 및 권한 확인 (파일)
SELECT f.id, f.name, f.sizeBytes, f.mimeType
FROM files f
WHERE f.id = :resourceId AND f.state = 'ACTIVE';

-- 공유 링크 생성
INSERT INTO share_links (
  id, shareCode, createdBy, resourceType, resourceId, title, description,
  accessType, password, startsAt, expiresAt, maxDownloads, currentDownloads,
  allowPreview, allowDownload, allowedIpRanges, status, createdAt, updatedAt
) VALUES (
  :id, :shareCode, :userId, :resourceType, :resourceId, :title, :description,
  :accessType, :passwordHash, :startsAt, :expiresAt, :maxDownloads, 0,
  :allowPreview, :allowDownload, :allowedIpRanges, 'ACTIVE', NOW(), NOW()
);
```

### 에러 처리

| 상황 | HTTP Status | 에러 코드 |
|------|-------------|----------|
| 리소스 없음 | 404 | RESOURCE_NOT_FOUND |
| 권한 없음 | 403 | PERMISSION_DENIED |
| 정책 위반 - 기간 초과 | 400 | SHARE_DURATION_EXCEEDED |
| 정책 위반 - 한도 초과 | 400 | SHARE_LIMIT_EXCEEDED |
| 정책 위반 - 파일 크기 | 400 | FILE_SIZE_EXCEEDED |
| 정책 위반 - 파일 타입 | 400 | FILE_TYPE_NOT_ALLOWED |
| 정책 위반 - PUBLIC 불가 | 400 | PUBLIC_SHARE_NOT_ALLOWED |

---

## 1-2. GET /api/shares - 내 공유 목록 조회

### Request (Query Parameters)

```typescript
interface GetSharesQuery {
  status?: 'ACTIVE' | 'EXPIRED' | 'DISABLED' | 'DELETED';
  resourceType?: 'FILE' | 'FOLDER';
  search?: string;                  // 제목, 파일명 검색
  sortBy?: 'createdAt' | 'expiresAt' | 'title';
  sortOrder?: 'asc' | 'desc';
  page?: number;                    // 기본값: 1
  limit?: number;                   // 기본값: 20, 최대: 100
}
```

### Response

```typescript
interface GetSharesResponse {
  items: ShareListItem[];
  pagination: {
    page: number;
    limit: number;
    totalItems: number;
    totalPages: number;
  };
}

interface ShareListItem {
  id: string;
  shareCode: string;
  shareUrl: string;
  title: string;
  resourceType: 'FILE' | 'FOLDER';
  resourceName: string;             // 파일/폴더 이름
  accessType: 'PUBLIC' | 'PROTECTED' | 'PRIVATE';
  startsAt: string;
  expiresAt: string;
  maxDownloads: number | null;
  currentDownloads: number;
  status: 'ACTIVE' | 'EXPIRED' | 'DISABLED' | 'DELETED';
  guestCount: number;               // PRIVATE인 경우 게스트 수
  lastAccessedAt: string | null;    // 마지막 접근 시각
  createdAt: string;
}
```

### 처리 플로우
ㅔ
```
┌─────────────────────────────────────────────────────────────────────────┐
│  [GET /api/shares 처리 플로우]                                            │
│                                                                         │
│  1. 인증 확인                                                            │
│     └─ JwtAuthGuard → userId 추출                                       │
│                                                                         │
│  2. 쿼리 파라미터 파싱 및 기본값 설정                                      │
│                                                                         │
│  3. DB 조회                                                              │
│     ├─ share_links 조회 (createdBy = userId)                            │
│     ├─ 필터 적용 (status, resourceType, search)                         │
│     ├─ 정렬 적용                                                         │
│     ├─ 페이지네이션 적용                                                  │
│     └─ 집계 정보 JOIN (게스트 수, 마지막 접근)                            │
│                                                                         │
│  4. 리소스 이름 조회                                                     │
│     └─ files/folders JOIN으로 이름 가져오기                              │
│                                                                         │
│  5. 응답 변환 및 반환                                                    │
└─────────────────────────────────────────────────────────────────────────┘
```

### SQL

```sql
-- 공유 목록 조회 (페이지네이션 포함)
SELECT 
  sl.id,
  sl.shareCode,
  sl.title,
  sl.resourceType,
  sl.resourceId,
  sl.accessType,
  sl.startsAt,
  sl.expiresAt,
  sl.maxDownloads,
  sl.currentDownloads,
  sl.status,
  sl.createdAt,
  -- 리소스 이름 (파일 또는 폴더)
  CASE 
    WHEN sl.resourceType = 'FILE' THEN f.name
    WHEN sl.resourceType = 'FOLDER' THEN fo.name
  END as resourceName,
  -- 게스트 수
  (SELECT COUNT(*) FROM share_link_guests slg WHERE slg.shareLinkId = sl.id) as guestCount,
  -- 마지막 접근
  (SELECT MAX(accessedAt) FROM share_access_logs sal WHERE sal.shareLinkId = sl.id) as lastAccessedAt
FROM share_links sl
LEFT JOIN files f ON sl.resourceType = 'FILE' AND sl.resourceId = f.id
LEFT JOIN folders fo ON sl.resourceType = 'FOLDER' AND sl.resourceId = fo.id
WHERE sl.createdBy = :userId
  AND (:status IS NULL OR sl.status = :status)
  AND (:resourceType IS NULL OR sl.resourceType = :resourceType)
  AND (:search IS NULL OR sl.title ILIKE :searchPattern OR f.name ILIKE :searchPattern OR fo.name ILIKE :searchPattern)
ORDER BY sl.createdAt DESC
LIMIT :limit OFFSET :offset;

-- 전체 개수 조회
SELECT COUNT(*) as totalItems
FROM share_links sl
WHERE sl.createdBy = :userId
  AND (:status IS NULL OR sl.status = :status)
  AND (:resourceType IS NULL OR sl.resourceType = :resourceType);
```

---

## 1-3. GET /api/shares/{id} - 공유 상세 조회

### Response

```typescript
interface ShareDetailResponse {
  id: string;
  shareCode: string;
  shareUrl: string;
  
  // 기본 정보
  title: string;
  description: string | null;
  resourceType: 'FILE' | 'FOLDER';
  resourceId: string;
  resourceName: string;
  resourceSize: number;             // bytes
  resourceMimeType: string | null;
  
  // 접근 제어
  accessType: 'PUBLIC' | 'PROTECTED' | 'PRIVATE';
  hasPassword: boolean;
  
  // 기간 제어
  startsAt: string;
  expiresAt: string;
  
  // 다운로드 제어
  maxDownloads: number | null;
  currentDownloads: number;
  
  // 추가 제어
  allowPreview: boolean;
  allowDownload: boolean;
  allowedIpRanges: string[] | null;
  
  // 상태
  status: 'ACTIVE' | 'EXPIRED' | 'DISABLED' | 'DELETED';
  
  // 게스트 목록 (PRIVATE인 경우)
  guests: ShareGuest[];
  
  // 통계
  stats: {
    totalViews: number;
    totalDownloads: number;
    uniqueVisitors: number;
    lastAccessedAt: string | null;
  };
  
  createdAt: string;
  updatedAt: string;
}

interface ShareGuest {
  id: string;
  guestUserId: string;
  email: string;
  name: string;
  grantedAt: string;
  lastAccessedAt: string | null;
}
```

### 처리 플로우

```
┌─────────────────────────────────────────────────────────────────────────┐
│  [GET /api/shares/{id} 처리 플로우]                                       │
│                                                                         │
│  1. 인증 확인                                                            │
│                                                                         │
│  2. 공유 링크 조회                                                       │
│     └─ share_links WHERE id = :id                                       │
│                                                                         │
│  3. 권한 확인                                                            │
│     └─ createdBy = userId 또는 관리자                                   │
│                                                                         │
│  4. 리소스 정보 조회                                                     │
│     └─ files/folders 상세 정보                                          │
│                                                                         │
│  5. 게스트 목록 조회 (PRIVATE인 경우)                                    │
│     └─ share_link_guests + guest_users JOIN                             │
│                                                                         │
│  6. 통계 정보 조회                                                       │
│     └─ share_access_logs 집계                                           │
│                                                                         │
│  7. 응답 반환                                                            │
└─────────────────────────────────────────────────────────────────────────┘
```

### SQL

```sql
-- 공유 상세 조회
SELECT 
  sl.*,
  CASE 
    WHEN sl.resourceType = 'FILE' THEN f.name
    WHEN sl.resourceType = 'FOLDER' THEN fo.name
  END as resourceName,
  CASE 
    WHEN sl.resourceType = 'FILE' THEN f.sizeBytes
    WHEN sl.resourceType = 'FOLDER' THEN NULL
  END as resourceSize,
  CASE 
    WHEN sl.resourceType = 'FILE' THEN f.mimeType
    ELSE NULL
  END as resourceMimeType
FROM share_links sl
LEFT JOIN files f ON sl.resourceType = 'FILE' AND sl.resourceId = f.id
LEFT JOIN folders fo ON sl.resourceType = 'FOLDER' AND sl.resourceId = fo.id
WHERE sl.id = :id;

-- 게스트 목록 조회
SELECT 
  slg.id,
  slg.guestUserId,
  gu.email,
  gu.name,
  slg.grantedAt,
  (SELECT MAX(accessedAt) FROM share_access_logs sal 
   WHERE sal.shareLinkId = slg.shareLinkId AND sal.guestUserId = slg.guestUserId) as lastAccessedAt
FROM share_link_guests slg
JOIN guest_users gu ON slg.guestUserId = gu.id
WHERE slg.shareLinkId = :shareLinkId;

-- 통계 조회
SELECT 
  COUNT(*) as totalViews,
  COUNT(CASE WHEN accessType = 'DOWNLOAD' THEN 1 END) as totalDownloads,
  COUNT(DISTINCT COALESCE(guestUserId, accessIp)) as uniqueVisitors,
  MAX(accessedAt) as lastAccessedAt
FROM share_access_logs
WHERE shareLinkId = :shareLinkId;
```

---

## 1-4. PUT /api/shares/{id} - 공유 수정

### Request

```typescript
interface UpdateShareRequest {
  title?: string;
  description?: string;
  
  // 접근 제어 변경
  accessType?: 'PUBLIC' | 'PROTECTED' | 'PRIVATE';
  password?: string;                // PROTECTED로 변경 시 또는 비밀번호 변경 시
  
  // 기간 제어
  startsAt?: string;
  expiresAt?: string;
  
  // 다운로드 제어
  maxDownloads?: number | null;
  
  // 추가 제어
  allowPreview?: boolean;
  allowDownload?: boolean;
  allowedIpRanges?: string[] | null;
  
  // 상태 변경
  status?: 'ACTIVE' | 'DISABLED';
}
```

### Response

```typescript
interface UpdateShareResponse {
  id: string;
  shareCode: string;
  // ... 업데이트된 필드들
  updatedAt: string;
}
```

### 처리 플로우

```
┌─────────────────────────────────────────────────────────────────────────┐
│  [PUT /api/shares/{id} 처리 플로우]                                       │
│                                                                         │
│  1. 인증 및 권한 확인                                                    │
│     └─ createdBy = userId 또는 관리자                                   │
│                                                                         │
│  2. 기존 데이터 조회                                                     │
│     └─ SELECT ... FOR UPDATE (동시성 제어)                              │
│                                                                         │
│  3. 유효성 검사                                                          │
│     ├─ expiresAt > startsAt                                             │
│     ├─ maxDownloads >= currentDownloads (경고 또는 에러)                │
│     └─ 정책 검증                                                         │
│                                                                         │
│  4. 변경 사항 처리                                                       │
│     ├─ accessType 변경 시 추가 처리                                     │
│     │   ├─ PUBLIC → PROTECTED: password 필수                            │
│     │   └─ * → PRIVATE: 기존 게스트 유지                                │
│     └─ password 변경 시 bcrypt 해싱                                     │
│                                                                         │
│  5. DB 업데이트                                                          │
│     └─ share_links UPDATE                                               │
│                                                                         │
│  6. 이벤트 기록                                                          │
│     └─ 감사 로그                                                         │
│                                                                         │
│  7. 응답 반환                                                            │
└─────────────────────────────────────────────────────────────────────────┘
```

### SQL

```sql
-- 기존 데이터 조회 (잠금)
SELECT * FROM share_links 
WHERE id = :id AND createdBy = :userId AND status != 'DELETED'
FOR UPDATE;

-- 업데이트
UPDATE share_links SET
  title = COALESCE(:title, title),
  description = COALESCE(:description, description),
  accessType = COALESCE(:accessType, accessType),
  password = CASE WHEN :password IS NOT NULL THEN :passwordHash ELSE password END,
  startsAt = COALESCE(:startsAt, startsAt),
  expiresAt = COALESCE(:expiresAt, expiresAt),
  maxDownloads = CASE WHEN :maxDownloads IS NOT NULL THEN :maxDownloads ELSE maxDownloads END,
  allowPreview = COALESCE(:allowPreview, allowPreview),
  allowDownload = COALESCE(:allowDownload, allowDownload),
  allowedIpRanges = COALESCE(:allowedIpRanges, allowedIpRanges),
  status = COALESCE(:status, status),
  updatedAt = NOW()
WHERE id = :id;
```

---

## 1-5. DELETE /api/shares/{id} - 공유 삭제

### Response

```typescript
interface DeleteShareResponse {
  id: string;
  status: 'DELETED';
  deletedAt: string;
}
```

### 처리 플로우

```
┌─────────────────────────────────────────────────────────────────────────┐
│  [DELETE /api/shares/{id} 처리 플로우]                                    │
│                                                                         │
│  1. 인증 및 권한 확인                                                    │
│                                                                         │
│  2. 공유 링크 조회                                                       │
│     └─ 이미 DELETED 상태인 경우 에러                                    │
│                                                                         │
│  3. 소프트 삭제                                                          │
│     └─ status = 'DELETED'                                               │
│                                                                         │
│  4. 연관 데이터 처리                                                     │
│     └─ share_link_guests 유지 (감사 목적)                               │
│                                                                         │
│  5. 감사 로그 기록                                                       │
│                                                                         │
│  6. 응답 반환                                                            │
└─────────────────────────────────────────────────────────────────────────┘
```

### SQL

```sql
-- 소프트 삭제
UPDATE share_links SET
  status = 'DELETED',
  updatedAt = NOW()
WHERE id = :id AND createdBy = :userId AND status != 'DELETED';
```

---

## 1-6. POST /api/shares/{id}/guests - 게스트 권한 부여

### Request

```typescript
interface AddGuestRequest {
  guestUserId?: string;             // 기존 게스트 ID
  // 또는 새 게스트 생성
  newGuest?: {
    email: string;
    name: string;
    phone?: string;
    company?: string;
  };
  sendNotification?: boolean;       // 알림 이메일 발송 여부
}
```

### Response

```typescript
interface AddGuestResponse {
  id: string;                       // share_link_guests.id
  shareLinkId: string;
  guestUserId: string;
  guestEmail: string;
  guestName: string;
  grantedAt: string;
}
```

### 처리 플로우

```
┌─────────────────────────────────────────────────────────────────────────┐
│  [POST /api/shares/{id}/guests 처리 플로우]                               │
│                                                                         │
│  1. 인증 및 권한 확인                                                    │
│                                                                         │
│  2. 공유 링크 조회 및 검증                                               │
│     ├─ 존재 여부                                                         │
│     └─ ACTIVE/DISABLED 상태                                             │
│                                                                         │
│  3. 게스트 확인/생성                                                     │
│     ├─ guestUserId 제공된 경우 → 조회                                   │
│     └─ newGuest 제공된 경우 → 이메일 중복 체크 후 생성                   │
│                                                                         │
│  4. 정책 검증                                                            │
│     └─ 공유당 최대 게스트 수 (maxGuestsPerShare)                        │
│                                                                         │
│  5. 중복 체크                                                            │
│     └─ share_link_guests UNIQUE(shareLinkId, guestUserId)               │
│                                                                         │
│  6. DB 트랜잭션                                                          │
│     ├─ (새 게스트인 경우) guest_users INSERT                            │
│     └─ share_link_guests INSERT                                         │
│                                                                         │
│  7. 알림 발송 (선택)                                                     │
│     └─ 이메일 발송                                                       │
│                                                                         │
│  8. 응답 반환                                                            │
└─────────────────────────────────────────────────────────────────────────┘
```

### SQL

```sql
-- 게스트 수 확인
SELECT COUNT(*) as guestCount 
FROM share_link_guests 
WHERE shareLinkId = :shareLinkId;

-- 이메일로 기존 게스트 조회
SELECT * FROM guest_users WHERE email = :email;

-- 새 게스트 생성
INSERT INTO guest_users (
  id, email, name, phone, company, status, createdAt, updatedAt, createdBy
) VALUES (
  :id, :email, :name, :phone, :company, 'ACTIVE', NOW(), NOW(), :createdBy
);

-- 게스트 권한 부여
INSERT INTO share_link_guests (
  id, shareLinkId, guestUserId, grantedBy, grantedAt
) VALUES (
  :id, :shareLinkId, :guestUserId, :grantedBy, NOW()
);
```

---

## 1-7. DELETE /api/shares/{id}/guests/{guestId} - 게스트 권한 해제

### Response

```typescript
interface RemoveGuestResponse {
  shareLinkId: string;
  guestUserId: string;
  removedAt: string;
}
```

### 처리 플로우

```
┌─────────────────────────────────────────────────────────────────────────┐
│  [DELETE /api/shares/{id}/guests/{guestId} 처리 플로우]                   │
│                                                                         │
│  1. 인증 및 권한 확인                                                    │
│                                                                         │
│  2. 매핑 존재 여부 확인                                                  │
│     └─ share_link_guests 조회                                           │
│                                                                         │
│  3. 매핑 삭제                                                            │
│     └─ share_link_guests DELETE                                         │
│                                                                         │
│  4. 응답 반환                                                            │
└─────────────────────────────────────────────────────────────────────────┘
```

### SQL

```sql
-- 매핑 삭제
DELETE FROM share_link_guests
WHERE shareLinkId = :shareLinkId AND guestUserId = :guestUserId;
```

---

## 1-8. GET /api/shares/{id}/logs - 접근 로그 조회

### Request (Query Parameters)

```typescript
interface GetShareLogsQuery {
  accessType?: 'DOWNLOAD' | 'PREVIEW';
  guestUserId?: string;
  startDate?: string;
  endDate?: string;
  page?: number;
  limit?: number;
}
```

### Response

```typescript
interface GetShareLogsResponse {
  items: ShareAccessLog[];
  pagination: {
    page: number;
    limit: number;
    totalItems: number;
    totalPages: number;
  };
}

interface ShareAccessLog {
  id: string;
  accessType: 'DOWNLOAD' | 'PREVIEW';
  guestUserId: string | null;
  guestEmail: string | null;
  guestName: string | null;
  accessIp: string;
  userAgent: string;
  accessedAt: string;
  success: boolean;
  failReason: string | null;
}
```

### SQL

```sql
SELECT 
  sal.id,
  sal.accessType,
  sal.guestUserId,
  gu.email as guestEmail,
  gu.name as guestName,
  sal.accessIp,
  sal.userAgent,
  sal.accessedAt,
  sal.success,
  sal.failReason
FROM share_access_logs sal
LEFT JOIN guest_users gu ON sal.guestUserId = gu.id
WHERE sal.shareLinkId = :shareLinkId
  AND (:accessType IS NULL OR sal.accessType = :accessType)
  AND (:guestUserId IS NULL OR sal.guestUserId = :guestUserId)
  AND (:startDate IS NULL OR sal.accessedAt >= :startDate)
  AND (:endDate IS NULL OR sal.accessedAt <= :endDate)
ORDER BY sal.accessedAt DESC
LIMIT :limit OFFSET :offset;
```

---

# 2. 게스트 API

## 2-1. GET /s/{shareCode} - 공유 링크 접근

### Response (성공 시)

```typescript
interface ShareAccessResponse {
  shareCode: string;
  title: string;
  description: string | null;
  
  // 리소스 정보
  resourceType: 'FILE' | 'FOLDER';
  resourceName: string;
  resourceSize: number | null;
  resourceMimeType: string | null;
  
  // 권한
  allowPreview: boolean;
  allowDownload: boolean;
  
  // 상태
  expiresAt: string;
  remainingDownloads: number | null;  // null = 무제한
  
  // 인증 필요 여부
  requiresPassword: boolean;          // PROTECTED
  requiresAuth: boolean;              // PRIVATE
  
  // 파일 목록 (FOLDER인 경우)
  files?: ShareFileItem[];
}

interface ShareFileItem {
  id: string;
  name: string;
  size: number;
  mimeType: string;
  canPreview: boolean;
}
```

### 처리 플로우

```
┌─────────────────────────────────────────────────────────────────────────┐
│  [GET /s/{shareCode} 처리 플로우]                                         │
│                                                                         │
│  1. shareCode로 공유 링크 조회                                           │
│     └─ share_links WHERE shareCode = :shareCode                         │
│                                                                         │
│  2. 유효성 검증                                                          │
│     ├─ (a) 존재 여부                                                    │
│     ├─ (b) status = ACTIVE                                              │
│     ├─ (c) 기간 확인: startsAt <= NOW() <= expiresAt                    │
│     ├─ (d) IP 제한 확인                                                  │
│     └─ (e) 다운로드 횟수 (미리보기는 제한 없음)                          │
│                                                                         │
│  3. 접근 유형별 처리                                                     │
│     ├─ PUBLIC: 즉시 콘텐츠 반환                                         │
│     ├─ PROTECTED: requiresPassword = true 반환                          │
│     └─ PRIVATE: requiresAuth = true 반환                                │
│                                                                         │
│  4. 리소스 정보 조회                                                     │
│     └─ files/folders 정보                                               │
│                                                                         │
│  5. 접근 로그 기록                                                       │
│     └─ share_access_logs INSERT (PREVIEW)                               │
│                                                                         │
│  6. 응답 반환                                                            │
└─────────────────────────────────────────────────────────────────────────┘
```

### SQL

```sql
-- 공유 링크 조회
SELECT 
  sl.*,
  CASE 
    WHEN sl.resourceType = 'FILE' THEN f.name
    WHEN sl.resourceType = 'FOLDER' THEN fo.name
  END as resourceName,
  CASE 
    WHEN sl.resourceType = 'FILE' THEN f.sizeBytes
    ELSE NULL
  END as resourceSize,
  f.mimeType as resourceMimeType
FROM share_links sl
LEFT JOIN files f ON sl.resourceType = 'FILE' AND sl.resourceId = f.id
LEFT JOIN folders fo ON sl.resourceType = 'FOLDER' AND sl.resourceId = fo.id
WHERE sl.shareCode = :shareCode;

-- 접근 로그 기록
INSERT INTO share_access_logs (
  id, shareLinkId, guestUserId, accessType, accessIp, userAgent, accessedAt, success, failReason
) VALUES (
  :id, :shareLinkId, :guestUserId, 'PREVIEW', :accessIp, :userAgent, NOW(), :success, :failReason
);
```

### 에러 응답

```typescript
interface ShareAccessError {
  error: string;
  code: 'NOT_FOUND' | 'EXPIRED' | 'NOT_STARTED' | 'DISABLED' | 'IP_BLOCKED';
  message: string;
}
```

---

## 2-2. POST /s/{shareCode}/verify - 비밀번호 검증

### Request

```typescript
interface VerifyPasswordRequest {
  password: string;
}
```

### Response

```typescript
interface VerifyPasswordResponse {
  success: boolean;
  token?: string;                   // 성공 시 세션 토큰 (쿠키 또는 헤더)
  expiresIn?: number;               // 토큰 유효 시간 (초)
}
```

### 처리 플로우

```
┌─────────────────────────────────────────────────────────────────────────┐
│  [POST /s/{shareCode}/verify 처리 플로우]                                 │
│                                                                         │
│  1. 공유 링크 조회                                                       │
│     └─ accessType = 'PROTECTED' 확인                                    │
│                                                                         │
│  2. 비밀번호 검증                                                        │
│     └─ bcrypt.compare(password, sl.password)                            │
│                                                                         │
│  3. 실패 횟수 체크                                                       │
│     ├─ Redis 또는 DB에 실패 횟수 저장                                   │
│     └─ N회 초과 시 일시 차단                                            │
│                                                                         │
│  4. 성공 시                                                              │
│     ├─ 세션 토큰 생성 (JWT 또는 랜덤)                                   │
│     └─ 쿠키 설정 또는 토큰 반환                                         │
│                                                                         │
│  5. 접근 로그 기록                                                       │
│                                                                         │
│  6. 응답 반환                                                            │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 2-3. POST /s/{shareCode}/auth - 게스트 로그인

### Request

```typescript
interface GuestAuthRequest {
  email: string;
  password?: string;                // 계정에 비밀번호가 설정된 경우
}
```

### Response

```typescript
interface GuestAuthResponse {
  success: boolean;
  token?: string;                   // 게스트 세션 토큰
  guest?: {
    id: string;
    email: string;
    name: string;
  };
  // 이메일 인증 필요한 경우
  requiresEmailVerification?: boolean;
  verificationSent?: boolean;
}
```

### 처리 플로우

```
┌─────────────────────────────────────────────────────────────────────────┐
│  [POST /s/{shareCode}/auth 처리 플로우]                                   │
│                                                                         │
│  1. 공유 링크 조회                                                       │
│     └─ accessType = 'PRIVATE' 확인                                      │
│                                                                         │
│  2. 게스트 유저 조회                                                     │
│     └─ guest_users WHERE email = :email                                 │
│                                                                         │
│  3. 권한 확인                                                            │
│     └─ share_link_guests 매핑 존재 여부                                 │
│                                                                         │
│  4. 인증 처리                                                            │
│     ├─ 비밀번호 설정된 경우 → 비밀번호 검증                              │
│     └─ 비밀번호 없는 경우 → 이메일 인증 링크 발송                        │
│                                                                         │
│  5. 세션 생성                                                            │
│     └─ 게스트용 JWT 발급 (제한된 권한)                                  │
│                                                                         │
│  6. 접근 로그 기록                                                       │
│                                                                         │
│  7. 응답 반환                                                            │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 2-4. GET /s/{shareCode}/download - 파일 다운로드

### Request (Query Parameters)

```typescript
interface DownloadQuery {
  fileId?: string;                  // FOLDER 공유인 경우 특정 파일 ID
  token?: string;                   // 일회성 다운로드 토큰 (옵션)
}
```

### Response

- Content-Type: application/octet-stream (또는 실제 MIME 타입)
- Content-Disposition: attachment; filename="파일명"
- 파일 스트림

### 처리 플로우

```
┌─────────────────────────────────────────────────────────────────────────┐
│  [GET /s/{shareCode}/download 처리 플로우]                                │
│                                                                         │
│  1. 인증 확인                                                            │
│     ├─ PUBLIC: 즉시 진행                                                │
│     ├─ PROTECTED: 세션 토큰 확인                                        │
│     └─ PRIVATE: 게스트 토큰 확인                                        │
│                                                                         │
│  2. 공유 링크 유효성 검증                                                │
│     ├─ status = ACTIVE                                                  │
│     ├─ 기간 유효                                                         │
│     ├─ allowDownload = true                                             │
│     └─ 다운로드 횟수 한도 확인                                           │
│                                                                         │
│  3. 리소스 조회                                                          │
│     ├─ FILE: 직접 파일 조회                                             │
│     └─ FOLDER: fileId로 하위 파일 조회                                  │
│                                                                         │
│  4. 다운로드 카운트 증가                                                 │
│     └─ currentDownloads += 1 (동시성 제어)                              │
│                                                                         │
│  5. 접근 로그 기록                                                       │
│     └─ accessType = 'DOWNLOAD'                                          │
│                                                                         │
│  6. 파일 스트림 전송                                                     │
│     └─ NAS에서 파일 읽어서 스트림 전송                                  │
│                                                                         │
│  7. (한도 도달 시) 상태 업데이트                                         │
│     └─ currentDownloads >= maxDownloads → 알림                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### SQL

```sql
-- 다운로드 횟수 증가 (동시성 제어)
UPDATE share_links SET
  currentDownloads = currentDownloads + 1,
  updatedAt = NOW()
WHERE shareCode = :shareCode
  AND (maxDownloads IS NULL OR currentDownloads < maxDownloads)
RETURNING currentDownloads, maxDownloads;

-- 파일 정보 조회 (NAS 경로 포함)
SELECT 
  f.id, f.name, f.sizeBytes, f.mimeType,
  fso.objectKey as nasPath
FROM files f
JOIN file_storage_objects fso ON f.id = fso.fileId AND fso.storageType = 'NAS'
WHERE f.id = :fileId;
```

---

## 2-5. GET /s/{shareCode}/preview - 파일 미리보기

### Request (Query Parameters)

```typescript
interface PreviewQuery {
  fileId?: string;                  // FOLDER 공유인 경우
}
```

### Response

- 이미지: Content-Type 그대로 반환
- PDF: PDF 스트림 반환
- 문서: 변환된 HTML 또는 이미지 반환
- 동영상: HLS/DASH 스트림 URL

### 처리 플로우

```
┌─────────────────────────────────────────────────────────────────────────┐
│  [GET /s/{shareCode}/preview 처리 플로우]                                 │
│                                                                         │
│  1. 인증 확인 (다운로드와 동일)                                          │
│                                                                         │
│  2. 공유 링크 유효성 검증                                                │
│     └─ allowPreview = true                                              │
│                                                                         │
│  3. 파일 유형 확인                                                       │
│     └─ 미리보기 가능 여부 체크                                          │
│                                                                         │
│  4. 미리보기 생성/반환                                                   │
│     ├─ 이미지: 리사이즈/압축 후 반환                                    │
│     ├─ PDF: PDF.js 뷰어용 스트림                                        │
│     ├─ 문서: LibreOffice 변환 후 반환                                   │
│     └─ 동영상: 스트리밍 URL 반환                                        │
│                                                                         │
│  5. 접근 로그 기록                                                       │
│     └─ accessType = 'PREVIEW'                                           │
│                                                                         │
│  6. 응답 반환                                                            │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 2-6. GET /s/{shareCode}/files - 폴더 내 파일 목록

### Request (Query Parameters)

```typescript
interface GetFilesQuery {
  folderId?: string;                // 하위 폴더 ID (기본: 루트)
  page?: number;
  limit?: number;
}
```

### Response

```typescript
interface GetFilesResponse {
  path: string;                     // 현재 경로
  items: ShareFileItem[];
  pagination: {
    page: number;
    limit: number;
    totalItems: number;
    totalPages: number;
  };
}

interface ShareFileItem {
  id: string;
  name: string;
  type: 'FILE' | 'FOLDER';
  size: number | null;              // 폴더는 null
  mimeType: string | null;
  canPreview: boolean;
  updatedAt: string;
}
```

### 처리 플로우

```
┌─────────────────────────────────────────────────────────────────────────┐
│  [GET /s/{shareCode}/files 처리 플로우]                                   │
│                                                                         │
│  1. 인증 확인                                                            │
│                                                                         │
│  2. 공유 링크 유효성 검증                                                │
│     └─ resourceType = 'FOLDER' 확인                                     │
│                                                                         │
│  3. 폴더 경로 검증                                                       │
│     └─ 요청된 folderId가 공유된 폴더의 하위인지 확인                    │
│                                                                         │
│  4. 파일/폴더 목록 조회                                                  │
│     ├─ 해당 폴더의 직계 자식만                                          │
│     └─ ACTIVE 상태만                                                     │
│                                                                         │
│  5. 미리보기 가능 여부 계산                                              │
│     └─ mimeType 기반 판단                                               │
│                                                                         │
│  6. 응답 반환                                                            │
└─────────────────────────────────────────────────────────────────────────┘
```

### SQL

```sql
-- 폴더가 공유 폴더의 하위인지 확인 (CTE 사용)
WITH RECURSIVE folder_path AS (
  SELECT id, parentId, name, 0 as depth
  FROM folders
  WHERE id = :requestedFolderId
  
  UNION ALL
  
  SELECT f.id, f.parentId, f.name, fp.depth + 1
  FROM folders f
  JOIN folder_path fp ON f.id = fp.parentId
  WHERE fp.depth < 100  -- 무한 루프 방지
)
SELECT EXISTS (
  SELECT 1 FROM folder_path WHERE id = :sharedFolderId
) as isValid;

-- 폴더 내 항목 조회
SELECT 
  id, name, 'FOLDER' as type, NULL as size, NULL as mimeType, updatedAt
FROM folders
WHERE parentId = :folderId AND state = 'ACTIVE'

UNION ALL

SELECT 
  id, name, 'FILE' as type, sizeBytes as size, mimeType, updatedAt
FROM files
WHERE folderId = :folderId AND state = 'ACTIVE'

ORDER BY type DESC, name ASC
LIMIT :limit OFFSET :offset;
```

---

# 3. 관리자 API

## 3-1. GET /api/admin/shares - 전체 공유 목록

### Request (Query Parameters)

```typescript
interface AdminGetSharesQuery {
  createdBy?: string;               // 생성자 ID
  status?: 'ACTIVE' | 'EXPIRED' | 'DISABLED' | 'DELETED';
  accessType?: 'PUBLIC' | 'PROTECTED' | 'PRIVATE';
  startDate?: string;               // 생성일 시작
  endDate?: string;                 // 생성일 종료
  search?: string;
  sortBy?: string;
  sortOrder?: 'asc' | 'desc';
  page?: number;
  limit?: number;
}
```

### Response

```typescript
interface AdminGetSharesResponse {
  items: AdminShareListItem[];
  pagination: {...};
}

interface AdminShareListItem {
  id: string;
  shareCode: string;
  title: string;
  resourceType: 'FILE' | 'FOLDER';
  resourceName: string;
  accessType: string;
  status: string;
  
  // 생성자 정보
  createdBy: {
    id: string;
    name: string;
    email: string;
  };
  
  // 통계
  currentDownloads: number;
  maxDownloads: number | null;
  guestCount: number;
  totalViews: number;
  
  expiresAt: string;
  createdAt: string;
}
```

### 처리 플로우

```
┌─────────────────────────────────────────────────────────────────────────┐
│  [GET /api/admin/shares 처리 플로우]                                      │
│                                                                         │
│  1. 관리자 권한 확인                                                     │
│                                                                         │
│  2. 전체 공유 목록 조회                                                  │
│     ├─ 모든 사용자의 공유 포함                                          │
│     ├─ 필터 적용                                                         │
│     └─ 정렬 및 페이지네이션                                              │
│                                                                         │
│  3. 생성자 정보 JOIN                                                     │
│                                                                         │
│  4. 집계 정보 계산                                                       │
│                                                                         │
│  5. 응답 반환                                                            │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 3-2. GET /api/admin/shares/stats - 공유 통계

### Response

```typescript
interface ShareStatsResponse {
  overview: {
    totalShares: number;
    activeShares: number;
    expiredShares: number;
    disabledShares: number;
  };
  
  today: {
    newShares: number;
    totalDownloads: number;
    totalViews: number;
    uniqueVisitors: number;
  };
  
  byAccessType: {
    public: number;
    protected: number;
    private: number;
  };
  
  expiringIn7Days: number;
  downloadLimitReaching: number;    // 80% 이상 사용
  
  topShares: {
    id: string;
    title: string;
    downloads: number;
    views: number;
  }[];
  
  recentActivity: {
    shareLinkId: string;
    shareTitle: string;
    accessType: 'DOWNLOAD' | 'PREVIEW';
    accessedAt: string;
  }[];
}
```

### SQL

```sql
-- 전체 통계
SELECT 
  COUNT(*) as totalShares,
  COUNT(CASE WHEN status = 'ACTIVE' THEN 1 END) as activeShares,
  COUNT(CASE WHEN status = 'EXPIRED' THEN 1 END) as expiredShares,
  COUNT(CASE WHEN status = 'DISABLED' THEN 1 END) as disabledShares,
  COUNT(CASE WHEN accessType = 'PUBLIC' THEN 1 END) as publicShares,
  COUNT(CASE WHEN accessType = 'PROTECTED' THEN 1 END) as protectedShares,
  COUNT(CASE WHEN accessType = 'PRIVATE' THEN 1 END) as privateShares
FROM share_links
WHERE status != 'DELETED';

-- 오늘 통계
SELECT 
  COUNT(DISTINCT sl.id) as newShares,
  COALESCE(SUM(CASE WHEN sal.accessType = 'DOWNLOAD' THEN 1 ELSE 0 END), 0) as totalDownloads,
  COUNT(sal.id) as totalViews,
  COUNT(DISTINCT COALESCE(sal.guestUserId, sal.accessIp)) as uniqueVisitors
FROM share_links sl
LEFT JOIN share_access_logs sal ON sl.id = sal.shareLinkId 
  AND sal.accessedAt >= CURRENT_DATE
WHERE sl.createdAt >= CURRENT_DATE;

-- 7일 내 만료 예정
SELECT COUNT(*) as expiringIn7Days
FROM share_links
WHERE status = 'ACTIVE' 
  AND expiresAt BETWEEN NOW() AND NOW() + INTERVAL '7 days';

-- 다운로드 한도 80% 이상
SELECT COUNT(*) as downloadLimitReaching
FROM share_links
WHERE status = 'ACTIVE'
  AND maxDownloads IS NOT NULL
  AND currentDownloads >= maxDownloads * 0.8;
```

---

## 3-3. PUT /api/admin/shares/{id}/disable - 공유 강제 비활성화

### Request

```typescript
interface AdminDisableShareRequest {
  reason: string;                   // 비활성화 사유 (감사용)
  notifyOwner?: boolean;            // 소유자 알림 여부
}
```

### Response

```typescript
interface AdminDisableShareResponse {
  id: string;
  status: 'DISABLED';
  disabledAt: string;
  disabledBy: string;               // 관리자 ID
  reason: string;
}
```

### 처리 플로우

```
┌─────────────────────────────────────────────────────────────────────────┐
│  [PUT /api/admin/shares/{id}/disable 처리 플로우]                         │
│                                                                         │
│  1. 관리자 권한 확인                                                     │
│                                                                         │
│  2. 공유 링크 조회                                                       │
│                                                                         │
│  3. 상태 변경                                                            │
│     └─ status = 'DISABLED'                                              │
│                                                                         │
│  4. 감사 로그 기록                                                       │
│     └─ 관리자 ID, 사유 포함                                              │
│                                                                         │
│  5. (선택) 소유자 알림                                                   │
│     └─ 이메일 발송                                                       │
│                                                                         │
│  6. 응답 반환                                                            │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 3-4. GET /api/admin/guests - 전체 게스트 목록

### Request (Query Parameters)

```typescript
interface AdminGetGuestsQuery {
  status?: 'ACTIVE' | 'SUSPENDED' | 'DELETED';
  createdBy?: string;
  search?: string;                  // 이메일, 이름, 회사
  sortBy?: string;
  sortOrder?: 'asc' | 'desc';
  page?: number;
  limit?: number;
}
```

### Response

```typescript
interface AdminGetGuestsResponse {
  items: AdminGuestListItem[];
  pagination: {...};
}

interface AdminGuestListItem {
  id: string;
  email: string;
  name: string;
  phone: string | null;
  company: string | null;
  status: 'ACTIVE' | 'SUSPENDED' | 'DELETED';
  isEmailVerified: boolean;
  
  // 생성자 정보
  createdBy: {
    id: string;
    name: string;
  };
  
  // 통계
  shareCount: number;               // 권한 부여된 공유 수
  totalDownloads: number;
  lastAccessedAt: string | null;
  
  createdAt: string;
}
```

---

## 3-5. PUT /api/admin/guests/{id}/suspend - 게스트 정지

### Request

```typescript
interface AdminSuspendGuestRequest {
  reason: string;
  notifyGuest?: boolean;
}
```

### Response

```typescript
interface AdminSuspendGuestResponse {
  id: string;
  status: 'SUSPENDED';
  suspendedAt: string;
  suspendedBy: string;
  reason: string;
}
```

---

## 3-6. GET /api/admin/policies - 공유 정책 조회

### Response

```typescript
interface SharePolicyResponse {
  id: string;
  policyName: string;
  
  // 기본값 설정
  defaultMaxDays: number;
  defaultMaxDownloads: number;
  defaultAccessType: 'PUBLIC' | 'PROTECTED' | 'PRIVATE';
  
  // 제한 설정
  maxFileSizeBytes: number;
  maxSharesPerUser: number;
  maxGuestsPerShare: number;
  allowedFileTypes: string[];
  blockedFileTypes: string[];
  
  // 보안 설정
  requirePassword: boolean;
  requireEmailVerification: boolean;
  allowPublicShares: boolean;
  
  isActive: boolean;
  updatedAt: string;
}
```

---

## 3-7. PUT /api/admin/policies - 공유 정책 수정

### Request

```typescript
interface UpdatePolicyRequest {
  policyName?: string;
  
  defaultMaxDays?: number;
  defaultMaxDownloads?: number;
  defaultAccessType?: 'PUBLIC' | 'PROTECTED' | 'PRIVATE';
  
  maxFileSizeBytes?: number;
  maxSharesPerUser?: number;
  maxGuestsPerShare?: number;
  allowedFileTypes?: string[];
  blockedFileTypes?: string[];
  
  requirePassword?: boolean;
  requireEmailVerification?: boolean;
  allowPublicShares?: boolean;
}
```

### 처리 플로우

```
┌─────────────────────────────────────────────────────────────────────────┐
│  [PUT /api/admin/policies 처리 플로우]                                    │
│                                                                         │
│  1. 관리자 권한 확인                                                     │
│                                                                         │
│  2. 입력 유효성 검사                                                     │
│     ├─ 숫자 필드 양수 확인                                               │
│     └─ 파일 타입 형식 확인                                               │
│                                                                         │
│  3. 기존 정책 조회                                                       │
│                                                                         │
│  4. 정책 업데이트                                                        │
│                                                                         │
│  5. 감사 로그 기록                                                       │
│     └─ 변경 전/후 값 기록                                                │
│                                                                         │
│  6. 캐시 무효화 (있는 경우)                                              │
│                                                                         │
│  7. 응답 반환                                                            │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 3-8. GET /api/admin/audit-logs - 감사 로그 조회

### Request (Query Parameters)

```typescript
interface GetAuditLogsQuery {
  actionType?: 'CREATE' | 'UPDATE' | 'DELETE' | 'ACCESS' | 'DOWNLOAD' | 'DISABLE' | 'SUSPEND';
  actorType?: 'USER' | 'GUEST' | 'ADMIN' | 'SYSTEM';
  actorId?: string;
  resourceType?: 'SHARE' | 'GUEST' | 'POLICY';
  resourceId?: string;
  startDate?: string;
  endDate?: string;
  success?: boolean;
  page?: number;
  limit?: number;
}
```

### Response

```typescript
interface GetAuditLogsResponse {
  items: AuditLogItem[];
  pagination: {...};
}

interface AuditLogItem {
  id: string;
  actionType: string;
  
  // 수행자 정보
  actorType: 'USER' | 'GUEST' | 'ADMIN' | 'SYSTEM';
  actorId: string | null;
  actorName: string | null;
  actorEmail: string | null;
  
  // 대상 정보
  resourceType: string;
  resourceId: string;
  resourceName: string | null;
  
  // 상세 정보
  details: Record<string, any>;     // 변경 전/후 값, 사유 등
  ipAddress: string | null;
  userAgent: string | null;
  
  success: boolean;
  errorMessage: string | null;
  
  timestamp: string;
}
```

### SQL

```sql
-- 감사 로그 조회 (가상의 audit_logs 테이블)
SELECT 
  al.*,
  -- 수행자 정보 (타입에 따라 다른 테이블 JOIN)
  CASE 
    WHEN al.actorType = 'USER' THEN u.name
    WHEN al.actorType = 'GUEST' THEN gu.name
    WHEN al.actorType = 'ADMIN' THEN u.name
    ELSE 'SYSTEM'
  END as actorName,
  CASE 
    WHEN al.actorType IN ('USER', 'ADMIN') THEN u.email
    WHEN al.actorType = 'GUEST' THEN gu.email
    ELSE NULL
  END as actorEmail
FROM audit_logs al
LEFT JOIN users u ON al.actorType IN ('USER', 'ADMIN') AND al.actorId = u.id
LEFT JOIN guest_users gu ON al.actorType = 'GUEST' AND al.actorId = gu.id
WHERE 
  (:actionType IS NULL OR al.actionType = :actionType)
  AND (:actorType IS NULL OR al.actorType = :actorType)
  AND (:actorId IS NULL OR al.actorId = :actorId)
  AND (:resourceType IS NULL OR al.resourceType = :resourceType)
  AND (:resourceId IS NULL OR al.resourceId = :resourceId)
  AND (:startDate IS NULL OR al.timestamp >= :startDate)
  AND (:endDate IS NULL OR al.timestamp <= :endDate)
  AND (:success IS NULL OR al.success = :success)
ORDER BY al.timestamp DESC
LIMIT :limit OFFSET :offset;
```

---

## 공통 에러 코드

| HTTP Status | 에러 코드 | 설명 |
|-------------|----------|------|
| 400 | VALIDATION_ERROR | 입력 유효성 검사 실패 |
| 401 | UNAUTHORIZED | 인증 필요 |
| 403 | FORBIDDEN | 권한 없음 |
| 404 | NOT_FOUND | 리소스 없음 |
| 409 | CONFLICT | 중복 또는 충돌 |
| 429 | TOO_MANY_REQUESTS | 요청 한도 초과 |
| 500 | INTERNAL_ERROR | 서버 오류 |

---

## 참고 문서

- [010.대외 공유.md](./010.대외%20공유.md) - 엔티티 정의 및 유즈 케이스
- [500.트레이스ID.md](./500.트레이스ID.md) - 요청 추적 및 로깅
- [0011.엔티티.md](./0011.엔티티.md) - 전체 엔티티 정의

