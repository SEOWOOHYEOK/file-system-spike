/**
 * ============================================================
 * ğŸ“¦ ShareTargetUserQueryService í…ŒìŠ¤íŠ¸
 * ============================================================
 *
 * ğŸ¯ í…ŒìŠ¤íŠ¸ ëŒ€ìƒ:
 *   - ShareTargetUserQueryService í´ë˜ìŠ¤
 *
 * ğŸ“‹ ë¹„ì¦ˆë‹ˆìŠ¤ ë§¥ë½:
 *   - íŒŒì¼ ê³µìœ  ëŒ€ìƒì ì„ íƒ UIì—ì„œ ë‚´ë¶€/ì™¸ë¶€ ì‚¬ìš©ìë¥¼ í†µí•© ê²€ìƒ‰
 *   - EXTERNAL_DEPARTMENT_ID ê¸°ë°˜ìœ¼ë¡œ ë‚´ë¶€/ì™¸ë¶€ êµ¬ë¶„
 *   - ì´ë¦„, ë¶€ì„œ, ì´ë©”ì¼, ì‚¬ìš©ì ìœ í˜• í•„í„°ë§ + í˜ì´ì§€ë„¤ì´ì…˜
 *
 * âš ï¸ ì¤‘ìš” ê³ ë ¤ì‚¬í•­:
 *   - ë‹¨ì¼ SQLë¡œ ë‚´ë¶€/ì™¸ë¶€ í†µí•© ì¡°íšŒ (UNION ì•„ë‹Œ CASE WHEN)
 *   - type í•„í„°ì— ë”°ë¼ WHERE ì¡°ê±´ì´ ë™ì ìœ¼ë¡œ ë³€ê²½ë¨
 *   - EXTERNAL_DEPARTMENT_ID ë¯¸ì„¤ì • ì‹œ BusinessException ë°œìƒ
 * ============================================================
 */
import { Test, TestingModule } from '@nestjs/testing';
import { DataSource } from 'typeorm';
import { ConfigService } from '@nestjs/config';
import { ShareTargetUserQueryService } from './share-target-user-query.service';
import {
  ShareTargetUserQueryDto,
  ShareTargetUserType,
} from '../../interface/controller/share/dto/share-target-user.dto';
import { BusinessException } from '../../common/exceptions';

const EXTERNAL_DEPT_ID = 'ext-dept-001';

describe('ShareTargetUserQueryService', () => {
  let service: ShareTargetUserQueryService;
  let mockDataSource: { query: jest.Mock };
  let mockConfigService: { get: jest.Mock };

  /**
   * ğŸ­ Mock ì„¤ì •
   * ğŸ“ mockDataSource.query:
   *   - ì‹¤ì œ ë™ì‘: DBì—ì„œ Raw SQL ì‹¤í–‰
   *   - Mock ì´ìœ : ì‹¤ì œ DB ì—°ê²° ì—†ì´ SQL ìƒì„± ë¡œì§ê³¼ ê²°ê³¼ ë§¤í•‘ ê²€ì¦
   * ğŸ“ mockConfigService.get:
   *   - ì‹¤ì œ ë™ì‘: í™˜ê²½ë³€ìˆ˜ì—ì„œ EXTERNAL_DEPARTMENT_ID ì¡°íšŒ
   *   - Mock ì´ìœ : í™˜ê²½ë³€ìˆ˜ ì˜ì¡´ ì—†ì´ í…ŒìŠ¤íŠ¸
   */
  beforeEach(async () => {
    mockDataSource = {
      query: jest.fn(),
    };

    mockConfigService = {
      get: jest.fn().mockReturnValue(EXTERNAL_DEPT_ID),
    };

    const module: TestingModule = await Test.createTestingModule({
      providers: [
        ShareTargetUserQueryService,
        {
          provide: DataSource,
          useValue: mockDataSource,
        },
        {
          provide: ConfigService,
          useValue: mockConfigService,
        },
      ],
    }).compile();

    service = module.get<ShareTargetUserQueryService>(ShareTargetUserQueryService);
  });

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // í™˜ê²½ ì„¤ì • ê²€ì¦
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  describe('EXTERNAL_DEPARTMENT_ID í™˜ê²½ë³€ìˆ˜ ê²€ì¦', () => {
    /**
     * ğŸ“Œ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤: í™˜ê²½ë³€ìˆ˜ ë¯¸ì„¤ì • ì‹œ ì˜ˆì™¸ ë°œìƒ
     *
     * ğŸ¯ ê²€ì¦ ëª©ì :
     *   EXTERNAL_DEPARTMENT_IDê°€ ì—†ìœ¼ë©´ ë‚´ë¶€/ì™¸ë¶€ êµ¬ë¶„ì´ ë¶ˆê°€ëŠ¥í•˜ë¯€ë¡œ
     *   ì¦‰ì‹œ ì‹¤íŒ¨í•˜ì—¬ ì˜ëª»ëœ ë°ì´í„° ë°˜í™˜ì„ ë°©ì§€í•´ì•¼ í•œë‹¤.
     *
     * âœ… ê¸°ëŒ€ ê²°ê³¼:
     *   BusinessExceptionì´ ë°œìƒí•œë‹¤.
     */
    it('EXTERNAL_DEPARTMENT_ID ë¯¸ì„¤ì • ì‹œ BusinessExceptionì„ ë˜ì ¸ì•¼ í•œë‹¤', async () => {
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ“¥ GIVEN (ì‚¬ì „ ì¡°ê±´ ì„¤ì •)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      mockConfigService.get.mockReturnValue(undefined);
      const query = new ShareTargetUserQueryDto();

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ¬ WHEN & âœ… THEN
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      await expect(service.findAll(query)).rejects.toThrow(BusinessException);
    });
  });

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // í•„í„° ì—†ì´ ì „ì²´ ì¡°íšŒ
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  describe('ì „ì²´ ì¡°íšŒ (í•„í„° ì—†ìŒ)', () => {
    /**
     * ğŸ“Œ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤: ë‚´ë¶€/ì™¸ë¶€ ì‚¬ìš©ì í†µí•© ì¡°íšŒ
     *
     * ğŸ¯ ê²€ì¦ ëª©ì :
     *   í•„í„° ì—†ì´ í˜¸ì¶œí•˜ë©´ ë‚´ë¶€/ì™¸ë¶€ êµ¬ë¶„ ì—†ì´ ëª¨ë“  ì¬ì§ì¤‘ ì‚¬ìš©ìê°€ ë°˜í™˜ë˜ì–´ì•¼ í•œë‹¤.
     *   SQLì˜ CASE WHENìœ¼ë¡œ typeì´ ì •í™•íˆ íŒë³„ë˜ëŠ”ì§€ í™•ì¸.
     *
     * âœ… ê¸°ëŒ€ ê²°ê³¼:
     *   ë‚´ë¶€/ì™¸ë¶€ ì‚¬ìš©ìê°€ í•¨ê»˜ ë°˜í™˜ë˜ê³ , í˜ì´ì§€ë„¤ì´ì…˜ ì •ë³´ê°€ ì •í™•í•˜ë‹¤.
     */
    it('ë‚´ë¶€/ì™¸ë¶€ ì‚¬ìš©ìë¥¼ í†µí•©í•˜ì—¬ ë°˜í™˜í•´ì•¼ í•œë‹¤', async () => {
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ“¥ GIVEN (ì‚¬ì „ ì¡°ê±´ ì„¤ì •)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const query = new ShareTargetUserQueryDto();
      query.page = 1;
      query.pageSize = 20;

      mockDataSource.query
        // COUNT ì¿¼ë¦¬
        .mockResolvedValueOnce([{ total: '2' }])
        // DATA ì¿¼ë¦¬
        .mockResolvedValueOnce([
          {
            id: 'emp-1',
            name: 'í™ê¸¸ë™',
            email: 'hong@company.com',
            department: 'ê°œë°œíŒ€',
            roleName: 'ADMIN',
            type: 'INTERNAL',
            isActive: true,
          },
          {
            id: 'emp-2',
            name: 'ê¹€ì™¸ë¶€',
            email: 'kim@partner.com',
            department: 'ì™¸ë¶€í˜‘ë ¥ì‚¬',
            roleName: null,
            type: 'EXTERNAL',
            isActive: true,
          },
        ]);

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ¬ WHEN (í…ŒìŠ¤íŠ¸ ì‹¤í–‰)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const result = await service.findAll(query);

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // âœ… THEN (ê²°ê³¼ ê²€ì¦)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      expect(mockDataSource.query).toHaveBeenCalledTimes(2);
      expect(result.items).toHaveLength(2);
      expect(result.totalItems).toBe(2);
      expect(result.page).toBe(1);
      expect(result.pageSize).toBe(20);

      // ë‚´ë¶€ ì‚¬ìš©ì í™•ì¸
      expect(result.items[0].id).toBe('emp-1');
      expect(result.items[0].type).toBe('INTERNAL');
      expect(result.items[0].name).toBe('í™ê¸¸ë™');
      expect(result.items[0].roleName).toBe('ADMIN');

      // ì™¸ë¶€ ì‚¬ìš©ì í™•ì¸
      expect(result.items[1].id).toBe('emp-2');
      expect(result.items[1].type).toBe('EXTERNAL');
      expect(result.items[1].name).toBe('ê¹€ì™¸ë¶€');
      expect(result.items[1].roleName).toBeNull();
    });

    /**
     * ğŸ“Œ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤: ê²°ê³¼ê°€ ì—†ì„ ë•Œ ë¹ˆ ë°°ì—´ ë°˜í™˜
     *
     * ğŸ¯ ê²€ì¦ ëª©ì :
     *   COUNTê°€ 0ì´ë©´ DATA ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ì§€ ì•Šê³  ë¹ˆ ê²°ê³¼ë¥¼ ë°˜í™˜í•´ì•¼ í•œë‹¤.
     *   ë¶ˆí•„ìš”í•œ ì¿¼ë¦¬ ì‹¤í–‰ ë°©ì§€.
     *
     * âœ… ê¸°ëŒ€ ê²°ê³¼:
     *   itemsê°€ ë¹ˆ ë°°ì—´ì´ê³ , totalItemsê°€ 0ì´ë‹¤. DATA ì¿¼ë¦¬ëŠ” í˜¸ì¶œë˜ì§€ ì•ŠëŠ”ë‹¤.
     */
    it('ê²°ê³¼ê°€ ì—†ìœ¼ë©´ ë¹ˆ ë°°ì—´ê³¼ í•¨ê»˜ 0 totalItemsë¥¼ ë°˜í™˜í•´ì•¼ í•œë‹¤', async () => {
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ“¥ GIVEN (ì‚¬ì „ ì¡°ê±´ ì„¤ì •)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const query = new ShareTargetUserQueryDto();
      mockDataSource.query.mockResolvedValueOnce([{ total: '0' }]);

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ¬ WHEN (í…ŒìŠ¤íŠ¸ ì‹¤í–‰)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const result = await service.findAll(query);

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // âœ… THEN (ê²°ê³¼ ê²€ì¦)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      expect(result.items).toEqual([]);
      expect(result.totalItems).toBe(0);
      expect(result.totalPages).toBe(0);
      // COUNTë§Œ í˜¸ì¶œ, DATA ì¿¼ë¦¬ëŠ” ë¯¸í˜¸ì¶œ
      expect(mockDataSource.query).toHaveBeenCalledTimes(1);
    });
  });

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // type í•„í„°
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  describe('type í•„í„°', () => {
    /**
     * ğŸ“Œ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤: EXTERNAL í•„í„° ì‹œ ì™¸ë¶€ ë¶€ì„œë§Œ ì¡°íšŒ
     *
     * ğŸ¯ ê²€ì¦ ëª©ì :
     *   type=EXTERNALì´ë©´ WHEREì ˆì— departmentId = EXTERNAL_DEPT_ID ì¡°ê±´ì´ ì¶”ê°€ë˜ì–´
     *   ì™¸ë¶€ ì‚¬ìš©ìë§Œ ë°˜í™˜ë˜ì–´ì•¼ í•œë‹¤.
     *
     * âœ… ê¸°ëŒ€ ê²°ê³¼:
     *   SQLì— departmentId = $1 (EXTERNAL_DEPT_ID) ì¡°ê±´ì´ í¬í•¨ëœë‹¤.
     */
    it('type=EXTERNALì´ë©´ ì™¸ë¶€ ë¶€ì„œ ì¡°ê±´(departmentId =)ì„ í¬í•¨í•´ì•¼ í•œë‹¤', async () => {
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ“¥ GIVEN (ì‚¬ì „ ì¡°ê±´ ì„¤ì •)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const query = new ShareTargetUserQueryDto();
      query.type = ShareTargetUserType.EXTERNAL;

      mockDataSource.query
        .mockResolvedValueOnce([{ total: '0' }]);

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ¬ WHEN (í…ŒìŠ¤íŠ¸ ì‹¤í–‰)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      await service.findAll(query);

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // âœ… THEN (ê²°ê³¼ ê²€ì¦)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const countSql = mockDataSource.query.mock.calls[0][0];
      expect(countSql).toContain('edp."departmentId" = $1');
      expect(mockDataSource.query.mock.calls[0][1]).toContain(EXTERNAL_DEPT_ID);
    });

    /**
     * ğŸ“Œ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤: INTERNAL í•„í„° ì‹œ ì™¸ë¶€ ë¶€ì„œ ì œì™¸
     *
     * ğŸ¯ ê²€ì¦ ëª©ì :
     *   type=INTERNALì´ë©´ WHEREì ˆì— departmentId != EXTERNAL_DEPT_ID ì¡°ê±´ì´ ì¶”ê°€ë˜ì–´
     *   ë‚´ë¶€ ì‚¬ìš©ìë§Œ ë°˜í™˜ë˜ì–´ì•¼ í•œë‹¤.
     *
     * âœ… ê¸°ëŒ€ ê²°ê³¼:
     *   SQLì— departmentId != $1 (EXTERNAL_DEPT_ID) ì¡°ê±´ì´ í¬í•¨ëœë‹¤.
     */
    it('type=INTERNALì´ë©´ ì™¸ë¶€ ë¶€ì„œ ì œì™¸ ì¡°ê±´(departmentId !=)ì„ í¬í•¨í•´ì•¼ í•œë‹¤', async () => {
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ“¥ GIVEN (ì‚¬ì „ ì¡°ê±´ ì„¤ì •)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const query = new ShareTargetUserQueryDto();
      query.type = ShareTargetUserType.INTERNAL;

      mockDataSource.query
        .mockResolvedValueOnce([{ total: '0' }]);

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ¬ WHEN (í…ŒìŠ¤íŠ¸ ì‹¤í–‰)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      await service.findAll(query);

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // âœ… THEN (ê²°ê³¼ ê²€ì¦)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const countSql = mockDataSource.query.mock.calls[0][0];
      expect(countSql).toContain('edp."departmentId" != $1');
    });

    /**
     * ğŸ“Œ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤: type ë¯¸ì§€ì • ì‹œ departmentId í•„í„° ì—†ìŒ
     *
     * ğŸ¯ ê²€ì¦ ëª©ì :
     *   typeì´ ì—†ìœ¼ë©´ ë‚´ë¶€/ì™¸ë¶€ êµ¬ë¶„ ì—†ì´ ì „ì²´ ì¡°íšŒ. departmentId í•„í„°ê°€ ì—†ì–´ì•¼ í•œë‹¤.
     *
     * âœ… ê¸°ëŒ€ ê²°ê³¼:
     *   SQLì— departmentId ê´€ë ¨ ì¡°ê±´ì´ í¬í•¨ë˜ì§€ ì•ŠëŠ”ë‹¤.
     */
    it('type ë¯¸ì§€ì • ì‹œ WHEREì ˆì— departmentId í•„í„°ê°€ ì—†ì–´ì•¼ í•œë‹¤', async () => {
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ“¥ GIVEN (ì‚¬ì „ ì¡°ê±´ ì„¤ì •)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const query = new ShareTargetUserQueryDto();

      mockDataSource.query
        .mockResolvedValueOnce([{ total: '0' }]);

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ¬ WHEN (í…ŒìŠ¤íŠ¸ ì‹¤í–‰)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      await service.findAll(query);

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // âœ… THEN (ê²°ê³¼ ê²€ì¦)
      // WHEREì ˆë§Œ ì¶”ì¶œí•˜ì—¬ departmentId í•„í„° ì¡°ê±´ì´ ì—†ëŠ”ì§€ í™•ì¸
      // (JOINì˜ edp."departmentId" = d.idëŠ” ì œì™¸)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const countSql = mockDataSource.query.mock.calls[0][0];
      const whereClause = countSql.substring(countSql.indexOf('WHERE'));
      expect(whereClause).not.toContain('edp."departmentId" = $');
      expect(whereClause).not.toContain('edp."departmentId" != $');
    });
  });

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ê²€ìƒ‰ í•„í„° (name, department, email)
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  describe('ê²€ìƒ‰ í•„í„°', () => {
    /**
     * ğŸ“Œ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤: ì´ë¦„ í•„í„° (ILIKE ë¶€ë¶„ ì¼ì¹˜)
     *
     * ğŸ¯ ê²€ì¦ ëª©ì :
     *   name í•„í„°ê°€ ILIKEë¡œ ì ìš©ë˜ì–´ ë¶€ë¶„ ì¼ì¹˜ ê²€ìƒ‰ì´ ê°€ëŠ¥í•´ì•¼ í•œë‹¤.
     *
     * âœ… ê¸°ëŒ€ ê²°ê³¼:
     *   SQLì— e.name ILIKE ì¡°ê±´ì´ í¬í•¨ë˜ê³ , íŒŒë¼ë¯¸í„°ì— %ì´ë¦„% íŒ¨í„´ì´ ì „ë‹¬ëœë‹¤.
     */
    it('name í•„í„°ê°€ ILIKE ë¶€ë¶„ ì¼ì¹˜ë¡œ ì ìš©ë˜ì–´ì•¼ í•œë‹¤', async () => {
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ“¥ GIVEN (ì‚¬ì „ ì¡°ê±´ ì„¤ì •)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const query = new ShareTargetUserQueryDto();
      query.name = 'í™ê¸¸ë™';

      mockDataSource.query.mockResolvedValueOnce([{ total: '0' }]);

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ¬ WHEN (í…ŒìŠ¤íŠ¸ ì‹¤í–‰)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      await service.findAll(query);

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // âœ… THEN (ê²°ê³¼ ê²€ì¦)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const countSql = mockDataSource.query.mock.calls[0][0];
      const params = mockDataSource.query.mock.calls[0][1];
      expect(countSql).toContain('e.name ILIKE');
      expect(params).toContain('%í™ê¸¸ë™%');
    });

    /**
     * ğŸ“Œ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤: ë¶€ì„œëª… í•„í„° (ILIKE ë¶€ë¶„ ì¼ì¹˜)
     *
     * ğŸ¯ ê²€ì¦ ëª©ì :
     *   department í•„í„°ê°€ departments-infoì˜ departmentNameì— ILIKEë¡œ ì ìš©ë˜ì–´ì•¼ í•œë‹¤.
     *
     * âœ… ê¸°ëŒ€ ê²°ê³¼:
     *   SQLì— d."departmentName" ILIKE ì¡°ê±´ì´ í¬í•¨ëœë‹¤.
     */
    it('department í•„í„°ê°€ ILIKE ë¶€ë¶„ ì¼ì¹˜ë¡œ ì ìš©ë˜ì–´ì•¼ í•œë‹¤', async () => {
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ“¥ GIVEN (ì‚¬ì „ ì¡°ê±´ ì„¤ì •)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const query = new ShareTargetUserQueryDto();
      query.department = 'ê°œë°œ';

      mockDataSource.query.mockResolvedValueOnce([{ total: '0' }]);

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ¬ WHEN (í…ŒìŠ¤íŠ¸ ì‹¤í–‰)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      await service.findAll(query);

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // âœ… THEN (ê²°ê³¼ ê²€ì¦)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const countSql = mockDataSource.query.mock.calls[0][0];
      const params = mockDataSource.query.mock.calls[0][1];
      expect(countSql).toContain('d."departmentName" ILIKE');
      expect(params).toContain('%ê°œë°œ%');
    });

    /**
     * ğŸ“Œ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤: ì´ë©”ì¼ í•„í„° (ILIKE ë¶€ë¶„ ì¼ì¹˜)
     *
     * ğŸ¯ ê²€ì¦ ëª©ì :
     *   email í•„í„°ê°€ ILIKEë¡œ ì ìš©ë˜ì–´ì•¼ í•œë‹¤.
     *
     * âœ… ê¸°ëŒ€ ê²°ê³¼:
     *   SQLì— e.email ILIKE ì¡°ê±´ì´ í¬í•¨ëœë‹¤.
     */
    it('email í•„í„°ê°€ ILIKE ë¶€ë¶„ ì¼ì¹˜ë¡œ ì ìš©ë˜ì–´ì•¼ í•œë‹¤', async () => {
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ“¥ GIVEN (ì‚¬ì „ ì¡°ê±´ ì„¤ì •)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const query = new ShareTargetUserQueryDto();
      query.email = 'hong@';

      mockDataSource.query.mockResolvedValueOnce([{ total: '0' }]);

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ¬ WHEN (í…ŒìŠ¤íŠ¸ ì‹¤í–‰)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      await service.findAll(query);

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // âœ… THEN (ê²°ê³¼ ê²€ì¦)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const countSql = mockDataSource.query.mock.calls[0][0];
      const params = mockDataSource.query.mock.calls[0][1];
      expect(countSql).toContain('e.email ILIKE');
      expect(params).toContain('%hong@%');
    });

    /**
     * ğŸ“Œ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤: ë³µí•© í•„í„° (type + name + email)
     *
     * ğŸ¯ ê²€ì¦ ëª©ì :
     *   ì—¬ëŸ¬ í•„í„°ê°€ ë™ì‹œì— ì ìš©ë  ë•Œ ëª¨ë“  ì¡°ê±´ì´ ANDë¡œ ê²°í•©ë˜ì–´ì•¼ í•œë‹¤.
     *   íŒŒë¼ë¯¸í„° ì¸ë±ì‹±ì´ ì •í™•í•´ì•¼ SQL Injection ë°©ì§€ì™€ ì •í™•í•œ ê²°ê³¼ë¥¼ ë³´ì¥í•œë‹¤.
     *
     * âœ… ê¸°ëŒ€ ê²°ê³¼:
     *   ëª¨ë“  í•„í„° ì¡°ê±´ì´ SQLì— í¬í•¨ë˜ê³ , íŒŒë¼ë¯¸í„°ê°€ ì˜¬ë°”ë¥¸ ìˆœì„œë¡œ ì „ë‹¬ëœë‹¤.
     */
    it('ë³µí•© í•„í„°ê°€ AND ì¡°ê±´ìœ¼ë¡œ ê²°í•©ë˜ì–´ì•¼ í•œë‹¤', async () => {
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ“¥ GIVEN (ì‚¬ì „ ì¡°ê±´ ì„¤ì •)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const query = new ShareTargetUserQueryDto();
      query.type = ShareTargetUserType.INTERNAL;
      query.name = 'í™';
      query.email = 'hong';

      mockDataSource.query.mockResolvedValueOnce([{ total: '0' }]);

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ¬ WHEN (í…ŒìŠ¤íŠ¸ ì‹¤í–‰)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      await service.findAll(query);

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // âœ… THEN (ê²°ê³¼ ê²€ì¦)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const countSql = mockDataSource.query.mock.calls[0][0];
      const params = mockDataSource.query.mock.calls[0][1];

      // ëª¨ë“  ì¡°ê±´ í¬í•¨
      expect(countSql).toContain('e.status = \'ì¬ì§ì¤‘\'');
      expect(countSql).toContain('edp."departmentId" != $1');
      expect(countSql).toContain('e.name ILIKE');
      expect(countSql).toContain('e.email ILIKE');

      // íŒŒë¼ë¯¸í„° ìˆœì„œ: externalDeptId, %í™%, %hong%
      expect(params[0]).toBe(EXTERNAL_DEPT_ID);
      expect(params[1]).toBe('%í™%');
      expect(params[2]).toBe('%hong%');
    });
  });

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // í˜ì´ì§€ë„¤ì´ì…˜
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  describe('í˜ì´ì§€ë„¤ì´ì…˜', () => {
    /**
     * ğŸ“Œ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤: LIMIT/OFFSETì´ ì˜¬ë°”ë¥´ê²Œ ì ìš©
     *
     * ğŸ¯ ê²€ì¦ ëª©ì :
     *   page=2, pageSize=10ì´ë©´ LIMIT 10 OFFSET 10ìœ¼ë¡œ ë³€í™˜ë˜ì–´ì•¼ í•œë‹¤.
     *
     * âœ… ê¸°ëŒ€ ê²°ê³¼:
     *   DATA ì¿¼ë¦¬ì˜ ë§ˆì§€ë§‰ ë‘ íŒŒë¼ë¯¸í„°ê°€ pageSizeì™€ offsetì´ë‹¤.
     */
    it('LIMIT/OFFSET íŒŒë¼ë¯¸í„°ê°€ ì •í™•íˆ ì „ë‹¬ë˜ì–´ì•¼ í•œë‹¤', async () => {
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ“¥ GIVEN (ì‚¬ì „ ì¡°ê±´ ì„¤ì •)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const query = new ShareTargetUserQueryDto();
      query.page = 2;
      query.pageSize = 10;

      mockDataSource.query
        .mockResolvedValueOnce([{ total: '25' }])
        .mockResolvedValueOnce([]);

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ¬ WHEN (í…ŒìŠ¤íŠ¸ ì‹¤í–‰)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      await service.findAll(query);

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // âœ… THEN (ê²°ê³¼ ê²€ì¦)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const dataParams = mockDataSource.query.mock.calls[1][1];
      // ë§ˆì§€ë§‰ ë‘ íŒŒë¼ë¯¸í„°: pageSize=10, offset=(2-1)*10=10
      expect(dataParams[dataParams.length - 2]).toBe(10);
      expect(dataParams[dataParams.length - 1]).toBe(10);
    });

    /**
     * ğŸ“Œ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤: í˜ì´ì§€ë„¤ì´ì…˜ ë©”íƒ€ ì •ë³´ ì •í™•ì„±
     *
     * ğŸ¯ ê²€ì¦ ëª©ì :
     *   totalPages, hasNext, hasPrevê°€ totalItemsì™€ page/pageSizeë¡œ ì •í™•íˆ ê³„ì‚°ë˜ì–´ì•¼ í•œë‹¤.
     *
     * âœ… ê¸°ëŒ€ ê²°ê³¼:
     *   25ê±´, pageSize=10, page=2ì´ë©´ totalPages=3, hasNext=true, hasPrev=true
     */
    it('í˜ì´ì§€ë„¤ì´ì…˜ ë©”íƒ€ ì •ë³´ê°€ ì •í™•í•´ì•¼ í•œë‹¤', async () => {
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ“¥ GIVEN (ì‚¬ì „ ì¡°ê±´ ì„¤ì •)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const query = new ShareTargetUserQueryDto();
      query.page = 2;
      query.pageSize = 10;

      mockDataSource.query
        .mockResolvedValueOnce([{ total: '25' }])
        .mockResolvedValueOnce([
          { id: 'emp-1', name: 'í…ŒìŠ¤íŠ¸', email: 'test@t.com', department: 'íŒ€', roleName: null, type: 'INTERNAL', isActive: true },
        ]);

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ¬ WHEN (í…ŒìŠ¤íŠ¸ ì‹¤í–‰)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const result = await service.findAll(query);

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // âœ… THEN (ê²°ê³¼ ê²€ì¦)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      expect(result.totalItems).toBe(25);
      expect(result.totalPages).toBe(3); // ceil(25/10)
      expect(result.hasNext).toBe(true); // page 2 < totalPages 3
      expect(result.hasPrev).toBe(true); // page 2 > 1
    });
  });

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ê²°ê³¼ ë§¤í•‘
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  describe('ê²°ê³¼ ë§¤í•‘', () => {
    /**
     * ğŸ“Œ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤: roleNameì´ nullì¸ ê²½ìš° null ë°˜í™˜
     *
     * ğŸ¯ ê²€ì¦ ëª©ì :
     *   Roleì´ ë¯¸ë¶€ì—¬ëœ ì‚¬ìš©ìì˜ roleNameì´ undefinedê°€ ì•„ë‹ˆë¼ ëª…ì‹œì  nullì´ì–´ì•¼ í•œë‹¤.
     *   í”„ë¡ íŠ¸ì—ì„œ null ì²´í¬ë¡œ ì—­í•  ë¯¸ë¶€ì—¬ë¥¼ í‘œì‹œí•˜ê¸° ìœ„í•¨.
     *
     * âœ… ê¸°ëŒ€ ê²°ê³¼:
     *   roleNameì´ nullì´ë‹¤.
     */
    it('Role ë¯¸ë¶€ì—¬ ì‚¬ìš©ìì˜ roleNameì€ nullì´ì–´ì•¼ í•œë‹¤', async () => {
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ“¥ GIVEN (ì‚¬ì „ ì¡°ê±´ ì„¤ì •)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const query = new ShareTargetUserQueryDto();

      mockDataSource.query
        .mockResolvedValueOnce([{ total: '1' }])
        .mockResolvedValueOnce([
          {
            id: 'emp-1',
            name: 'í™ê¸¸ë™',
            email: 'hong@test.com',
            department: 'ê°œë°œíŒ€',
            roleName: undefined, // DBì—ì„œ NULL â†’ JS undefined
            type: 'INTERNAL',
            isActive: true,
          },
        ]);

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ¬ WHEN (í…ŒìŠ¤íŠ¸ ì‹¤í–‰)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const result = await service.findAll(query);

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // âœ… THEN (ê²°ê³¼ ê²€ì¦)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      expect(result.items[0].roleName).toBeNull();
    });

    /**
     * ğŸ“Œ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤: ì¬ì§ì¤‘ ì¡°ê±´ì´ í•­ìƒ SQLì— í¬í•¨
     *
     * ğŸ¯ ê²€ì¦ ëª©ì :
     *   í‡´ì‚¬ìê°€ ê³µìœ  ëŒ€ìƒìë¡œ ë…¸ì¶œë˜ë©´ ì•ˆ ë˜ë¯€ë¡œ, ì¬ì§ì¤‘ ì¡°ê±´ì€ í•­ìƒ í¬í•¨ë˜ì–´ì•¼ í•œë‹¤.
     *
     * âœ… ê¸°ëŒ€ ê²°ê³¼:
     *   SQL WHEREì ˆì— e.status = 'ì¬ì§ì¤‘' ì¡°ê±´ì´ í•­ìƒ í¬í•¨ëœë‹¤.
     */
    it('ì¬ì§ì¤‘ ì¡°ê±´ì´ í•­ìƒ SQLì— í¬í•¨ë˜ì–´ì•¼ í•œë‹¤', async () => {
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ“¥ GIVEN (ì‚¬ì „ ì¡°ê±´ ì„¤ì •)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const query = new ShareTargetUserQueryDto();

      mockDataSource.query.mockResolvedValueOnce([{ total: '0' }]);

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ¬ WHEN (í…ŒìŠ¤íŠ¸ ì‹¤í–‰)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      await service.findAll(query);

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // âœ… THEN (ê²°ê³¼ ê²€ì¦)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const countSql = mockDataSource.query.mock.calls[0][0];
      expect(countSql).toContain("e.status = 'ì¬ì§ì¤‘'");
    });
  });
});
