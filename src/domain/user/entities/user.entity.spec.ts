/**
 * ============================================================
 * ðŸ“¦ User ë„ë©”ì¸ ì—”í‹°í‹° í…ŒìŠ¤íŠ¸
 * ============================================================
 *
 * ðŸŽ¯ í…ŒìŠ¤íŠ¸ ëŒ€ìƒ:
 *   - User ë„ë©”ì¸ ì—”í‹°í‹° í´ëž˜ìŠ¤
 *
 * ðŸ“‹ ë¹„ì¦ˆë‹ˆìŠ¤ ë§¥ë½:
 *   - UserëŠ” DMS ì‹œìŠ¤í…œì—ì„œ ê¶Œí•œ(Authorization)ì˜ ì£¼ì²´
 *   - Employeeì™€ 1:1 ê´€ê³„ (ë™ì¼ ID ì‚¬ìš©)
 *   - í•˜ë‚˜ì˜ Roleë§Œ ë³´ìœ  ê°€ëŠ¥ (N:1 ê´€ê³„)
 *   - SSO ì¸ì¦ í›„ ê¶Œí•œ ê²€ì‚¬ì— ì‚¬ìš©ë¨
 *
 * âš ï¸ ì¤‘ìš” ê³ ë ¤ì‚¬í•­:
 *   - isActiveê°€ falseë©´ ê¶Œí•œì´ ìžˆì–´ë„ ì ‘ê·¼ ì°¨ë‹¨
 *   - roleIdê°€ nullì´ë©´ ê¶Œí•œ ì—†ìŒ
 * ============================================================
 */
import { User } from './user.entity';

describe('User Entity', () => {
  /**
   * ðŸ“Œ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤: User ì—”í‹°í‹° ìƒì„±
   *
   * ðŸŽ¯ ê²€ì¦ ëª©ì :
   *   User ì—”í‹°í‹°ê°€ ì˜¬ë°”ë¥¸ ì†ì„±ìœ¼ë¡œ ìƒì„±ë˜ëŠ”ì§€ í™•ì¸
   *
   * âœ… ê¸°ëŒ€ ê²°ê³¼:
   *   ëª¨ë“  ì†ì„±ì´ ì „ë‹¬ëœ ê°’ìœ¼ë¡œ ì´ˆê¸°í™”ë¨
   */
  it('should create a User with all properties', () => {
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ðŸ“¥ GIVEN (ì‚¬ì „ ì¡°ê±´ ì„¤ì •)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const props = {
      id: 'user-123',
      roleId: 'role-456',
      isActive: true,
      createdAt: new Date('2026-01-01'),
      updatedAt: new Date('2026-01-15'),
    };

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ðŸŽ¬ WHEN (í…ŒìŠ¤íŠ¸ ì‹¤í–‰)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const user = new User(props);

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // âœ… THEN (ê²°ê³¼ ê²€ì¦)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    expect(user.id).toBe('user-123');
    expect(user.roleId).toBe('role-456');
    expect(user.isActive).toBe(true);
    expect(user.createdAt).toEqual(new Date('2026-01-01'));
    expect(user.updatedAt).toEqual(new Date('2026-01-15'));
  });

  /**
   * ðŸ“Œ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤: Roleì´ ì—†ëŠ” User ìƒì„±
   *
   * ðŸŽ¯ ê²€ì¦ ëª©ì :
   *   ì‹ ê·œ UserëŠ” Role ì—†ì´ ìƒì„±ë  ìˆ˜ ìžˆì–´ì•¼ í•¨
   *   (Employee ë™ê¸°í™” ì‹œ roleId: nullë¡œ ìƒì„±)
   *
   * âœ… ê¸°ëŒ€ ê²°ê³¼:
   *   roleIdê°€ nullë¡œ ì„¤ì •ë¨
   */
  it('should create a User without a role (roleId: null)', () => {
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ðŸ“¥ GIVEN (ì‚¬ì „ ì¡°ê±´ ì„¤ì •)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const props = {
      id: 'user-123',
      roleId: null,
      isActive: true,
      createdAt: new Date(),
      updatedAt: new Date(),
    };

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ðŸŽ¬ WHEN (í…ŒìŠ¤íŠ¸ ì‹¤í–‰)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const user = new User(props);

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // âœ… THEN (ê²°ê³¼ ê²€ì¦)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    expect(user.roleId).toBeNull();
  });

  /**
   * ðŸ“Œ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤: ë¹„í™œì„± User ìƒì„±
   *
   * ðŸŽ¯ ê²€ì¦ ëª©ì :
   *   í‡´ì‚¬/íœ´ì§ Employee ë™ê¸°í™” ì‹œ isActive: falseë¡œ ì„¤ì •
   *
   * âœ… ê¸°ëŒ€ ê²°ê³¼:
   *   isActiveê°€ falseë¡œ ì„¤ì •ë¨
   */
  it('should create an inactive User (isActive: false)', () => {
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ðŸ“¥ GIVEN (ì‚¬ì „ ì¡°ê±´ ì„¤ì •)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const props = {
      id: 'user-123',
      roleId: 'role-456',
      isActive: false,
      createdAt: new Date(),
      updatedAt: new Date(),
    };

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ðŸŽ¬ WHEN (í…ŒìŠ¤íŠ¸ ì‹¤í–‰)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const user = new User(props);

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // âœ… THEN (ê²°ê³¼ ê²€ì¦)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    expect(user.isActive).toBe(false);
  });

  /**
   * ðŸ“Œ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤: Userì— Role ë¶€ì—¬
   *
   * ðŸŽ¯ ê²€ì¦ ëª©ì :
   *   ê´€ë¦¬ìžê°€ Userì—ê²Œ Roleì„ ë¶€ì—¬í•  ìˆ˜ ìžˆì–´ì•¼ í•¨
   *
   * âœ… ê¸°ëŒ€ ê²°ê³¼:
   *   roleIdê°€ ë³€ê²½ë˜ê³  updatedAtì´ ê°±ì‹ ë¨
   */
  it('should assign a role to User', () => {
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ðŸ“¥ GIVEN (ì‚¬ì „ ì¡°ê±´ ì„¤ì •)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const user = new User({
      id: 'user-123',
      roleId: null,
      isActive: true,
      createdAt: new Date('2026-01-01'),
      updatedAt: new Date('2026-01-01'),
    });

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ðŸŽ¬ WHEN (í…ŒìŠ¤íŠ¸ ì‹¤í–‰)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    user.assignRole('role-789');

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // âœ… THEN (ê²°ê³¼ ê²€ì¦)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    expect(user.roleId).toBe('role-789');
    expect(user.updatedAt.getTime()).toBeGreaterThan(
      new Date('2026-01-01').getTime(),
    );
  });

  /**
   * ðŸ“Œ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤: Userì˜ Role ì œê±°
   *
   * ðŸŽ¯ ê²€ì¦ ëª©ì :
   *   ê´€ë¦¬ìžê°€ Userì˜ Roleì„ ì œê±°í•  ìˆ˜ ìžˆì–´ì•¼ í•¨
   *
   * âœ… ê¸°ëŒ€ ê²°ê³¼:
   *   roleIdê°€ nullë¡œ ë³€ê²½ë¨
   */
  it('should remove role from User', () => {
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ðŸ“¥ GIVEN (ì‚¬ì „ ì¡°ê±´ ì„¤ì •)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const user = new User({
      id: 'user-123',
      roleId: 'role-456',
      isActive: true,
      createdAt: new Date(),
      updatedAt: new Date(),
    });

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ðŸŽ¬ WHEN (í…ŒìŠ¤íŠ¸ ì‹¤í–‰)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    user.removeRole();

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // âœ… THEN (ê²°ê³¼ ê²€ì¦)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    expect(user.roleId).toBeNull();
  });

  /**
   * ðŸ“Œ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤: User ë¹„í™œì„±í™”
   *
   * ðŸŽ¯ ê²€ì¦ ëª©ì :
   *   Employee í‡´ì‚¬ ì‹œ Userë¥¼ ë¹„í™œì„±í™”
   *
   * âœ… ê¸°ëŒ€ ê²°ê³¼:
   *   isActiveê°€ falseë¡œ ë³€ê²½ë¨
   */
  it('should deactivate User', () => {
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ðŸ“¥ GIVEN (ì‚¬ì „ ì¡°ê±´ ì„¤ì •)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const user = new User({
      id: 'user-123',
      roleId: 'role-456',
      isActive: true,
      createdAt: new Date(),
      updatedAt: new Date(),
    });

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ðŸŽ¬ WHEN (í…ŒìŠ¤íŠ¸ ì‹¤í–‰)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    user.deactivate();

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // âœ… THEN (ê²°ê³¼ ê²€ì¦)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    expect(user.isActive).toBe(false);
  });

  /**
   * ðŸ“Œ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤: User ìž¬í™œì„±í™”
   *
   * ðŸŽ¯ ê²€ì¦ ëª©ì :
   *   Employee ë³µì§ ì‹œ Userë¥¼ ìž¬í™œì„±í™”
   *
   * âœ… ê¸°ëŒ€ ê²°ê³¼:
   *   isActiveê°€ trueë¡œ ë³€ê²½ë¨
   */
  it('should activate User', () => {
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ðŸ“¥ GIVEN (ì‚¬ì „ ì¡°ê±´ ì„¤ì •)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const user = new User({
      id: 'user-123',
      roleId: 'role-456',
      isActive: false,
      createdAt: new Date(),
      updatedAt: new Date(),
    });

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ðŸŽ¬ WHEN (í…ŒìŠ¤íŠ¸ ì‹¤í–‰)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    user.activate();

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // âœ… THEN (ê²°ê³¼ ê²€ì¦)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    expect(user.isActive).toBe(true);
  });

  /**
   * ðŸ“Œ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤: ê¶Œí•œ ìžˆëŠ” Userì¸ì§€ í™•ì¸
   *
   * ðŸŽ¯ ê²€ì¦ ëª©ì :
   *   í™œì„± ìƒíƒœì´ê³  Roleì´ ìžˆëŠ” Userë§Œ ê¶Œí•œ ê²€ì‚¬ ëŒ€ìƒ
   *
   * âœ… ê¸°ëŒ€ ê²°ê³¼:
   *   isActive && roleId !== nullì¸ ê²½ìš°ì—ë§Œ true
   */
  describe('hasPermissionEligibility', () => {
    it('should return true when active and has role', () => {
      const user = new User({
        id: 'user-123',
        roleId: 'role-456',
        isActive: true,
        createdAt: new Date(),
        updatedAt: new Date(),
      });

      expect(user.hasPermissionEligibility()).toBe(true);
    });

    it('should return false when inactive', () => {
      const user = new User({
        id: 'user-123',
        roleId: 'role-456',
        isActive: false,
        createdAt: new Date(),
        updatedAt: new Date(),
      });

      expect(user.hasPermissionEligibility()).toBe(false);
    });

    it('should return false when no role assigned', () => {
      const user = new User({
        id: 'user-123',
        roleId: null,
        isActive: true,
        createdAt: new Date(),
        updatedAt: new Date(),
      });

      expect(user.hasPermissionEligibility()).toBe(false);
    });
  });
});
