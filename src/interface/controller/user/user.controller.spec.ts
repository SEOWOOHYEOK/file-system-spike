/**
 * ============================================================
 * ğŸ“¦ UserController í…ŒìŠ¤íŠ¸
 * ============================================================
 *
 * ğŸ¯ í…ŒìŠ¤íŠ¸ ëŒ€ìƒ:
 *   - UserController í´ë˜ìŠ¤
 *
 * ğŸ“‹ ë¹„ì¦ˆë‹ˆìŠ¤ ë§¥ë½:
 *   - User CRUD API ì œê³µ
 *   - Role ë¶€ì—¬/ì œê±° API ì œê³µ
 *   - ADMIN ê¶Œí•œì„ ê°€ì§„ ì‚¬ìš©ìë§Œ ì ‘ê·¼ ê°€ëŠ¥
 *
 * âš ï¸ ì¤‘ìš” ê³ ë ¤ì‚¬í•­:
 *   - ê¶Œí•œ ê²€ì‚¬ëŠ” Guardì—ì„œ ìˆ˜í–‰
 *   - ì‘ë‹µ í˜•ì‹ ì¼ê´€ì„± ìœ ì§€
 *   - Employee ì¡°íšŒëŠ” UserQueryService ì‚¬ìš© (DDD ì¤€ìˆ˜)
 * ============================================================
 */
import { Test, TestingModule } from '@nestjs/testing';
import { UserController } from './user.controller';
import { UserService } from '../../../business/user/user.service';
import { UserSyncService, SyncResult } from '../../../business/user/user-sync.service';
import { UserQueryService } from '../../../business/user/user-query.service';
import { User } from '../../../domain/user/entities/user.entity';
import { Role } from '../../../domain/role/entities/role.entity';
import { Permission } from '../../../domain/role/entities/permission.entity';
import { EmployeeStatus } from '../../../integrations/migration/organization/entities/employee.entity';
import type { UserWithEmployeeResponseDto } from './dto/user-with-employee-response.dto';
import type { UserFilterQueryDto } from './dto/user-filter-query.dto';

describe('UserController', () => {
  let controller: UserController;
  let mockUserService: jest.Mocked<UserService>;
  let mockUserSyncService: jest.Mocked<UserSyncService>;
  let mockUserQueryService: jest.Mocked<UserQueryService>;

  /**
   * ğŸ­ Mock ì„¤ì •
   * ğŸ“ mockUserService:
   *   - ì‹¤ì œ ë™ì‘: User ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ìˆ˜í–‰
   *   - Mock ì´ìœ : ì»¨íŠ¸ë¡¤ëŸ¬ ë¡œì§ë§Œ í…ŒìŠ¤íŠ¸
   * ğŸ“ mockUserSyncService:
   *   - ì‹¤ì œ ë™ì‘: Employeeâ†’User ë™ê¸°í™”
   *   - Mock ì´ìœ : ë™ê¸°í™” API í…ŒìŠ¤íŠ¸
   * ğŸ“ mockUserQueryService:
   *   - ì‹¤ì œ ë™ì‘: User+Employee í¬ë¡œìŠ¤ ë„ë©”ì¸ ì¡°íšŒ
   *   - Mock ì´ìœ : DDD ì¤€ìˆ˜ (Query Service ë¶„ë¦¬)
   */
  beforeEach(async () => {
    mockUserService = {
      findAll: jest.fn(),
      findById: jest.fn(),
      findByIdWithRole: jest.fn(),
      assignRole: jest.fn(),
      removeRole: jest.fn(),
    } as unknown as jest.Mocked<UserService>;

    mockUserSyncService = {
      syncEmployeesToUsers: jest.fn(),
    } as unknown as jest.Mocked<UserSyncService>;

    mockUserQueryService = {
      findAllWithEmployee: jest.fn(),
    } as unknown as jest.Mocked<UserQueryService>;

    const module: TestingModule = await Test.createTestingModule({
      controllers: [UserController],
      providers: [
        {
          provide: UserService,
          useValue: mockUserService,
        },
        {
          provide: UserSyncService,
          useValue: mockUserSyncService,
        },
        {
          provide: UserQueryService,
          useValue: mockUserQueryService,
        },
      ],
    }).compile();

    controller = module.get<UserController>(UserController);
  });

  /**
   * ğŸ“Œ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤: ì „ì²´ User ëª©ë¡ ì¡°íšŒ (Employee ì •ë³´ í¬í•¨ + í•„í„°ë§)
   *
   * ğŸ¯ ê²€ì¦ ëª©ì :
   *   GET /users API ë™ì‘ ê²€ì¦ (Employee ì •ë³´ í¬í•¨, í•„í„°ë§ ê°€ëŠ¥)
   *
   * âœ… ê¸°ëŒ€ ê²°ê³¼:
   *   User + Employee ëª©ë¡ ë°˜í™˜, í•„í„° ì ìš©
   */
  describe('findAll', () => {
    it('should return all users with employee information', async () => {
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ“¥ GIVEN (ì‚¬ì „ ì¡°ê±´ ì„¤ì •)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const usersWithEmployee: UserWithEmployeeResponseDto[] = [
        {
          id: 'user-1',
          roleId: 'role-1',
          isActive: true,
          createdAt: new Date(),
          updatedAt: new Date(),
          employee: {
            employeeNumber: 'EMP001',
            name: 'í™ê¸¸ë™',
            email: 'hong@test.com',
            phoneNumber: '010-1234-5678',
            hireDate: new Date('2020-01-01'),
            status: EmployeeStatus.Active,
            departmentPositions: [
              {
                departmentId: 'dept-1',
                departmentName: 'ê°œë°œíŒ€',
                positionId: 'pos-1',
                positionTitle: 'íŒ€ì¥',
                isManager: true,
              },
            ],
          },
        },
        {
          id: 'user-2',
          roleId: null,
          isActive: false,
          createdAt: new Date(),
          updatedAt: new Date(),
          employee: null,
        },
      ];
      mockUserQueryService.findAllWithEmployee.mockResolvedValue(usersWithEmployee);

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ¬ WHEN (í…ŒìŠ¤íŠ¸ ì‹¤í–‰)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const result = await controller.findAll({});

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // âœ… THEN (ê²°ê³¼ ê²€ì¦)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      expect(mockUserQueryService.findAllWithEmployee).toHaveBeenCalledWith({});
      expect(result).toHaveLength(2);
      expect(result[0].employee?.name).toBe('í™ê¸¸ë™');
    });

    it('should filter by name', async () => {
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ“¥ GIVEN (ì‚¬ì „ ì¡°ê±´ ì„¤ì •)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const filter = { name: 'í™ê¸¸ë™' };
      mockUserQueryService.findAllWithEmployee.mockResolvedValue([]);

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ¬ WHEN (í…ŒìŠ¤íŠ¸ ì‹¤í–‰)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      await controller.findAll(filter);

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // âœ… THEN (ê²°ê³¼ ê²€ì¦)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      expect(mockUserQueryService.findAllWithEmployee).toHaveBeenCalledWith(filter);
    });

    it('should filter by employeeNumber', async () => {
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ“¥ GIVEN (ì‚¬ì „ ì¡°ê±´ ì„¤ì •)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const filter = { employeeNumber: 'EMP001' };
      mockUserQueryService.findAllWithEmployee.mockResolvedValue([]);

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ¬ WHEN (í…ŒìŠ¤íŠ¸ ì‹¤í–‰)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      await controller.findAll(filter);

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // âœ… THEN (ê²°ê³¼ ê²€ì¦)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      expect(mockUserQueryService.findAllWithEmployee).toHaveBeenCalledWith(filter);
    });

    it('should filter by status', async () => {
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ“¥ GIVEN (ì‚¬ì „ ì¡°ê±´ ì„¤ì •)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const filter = { status: EmployeeStatus.Active };
      mockUserQueryService.findAllWithEmployee.mockResolvedValue([]);

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ¬ WHEN (í…ŒìŠ¤íŠ¸ ì‹¤í–‰)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      await controller.findAll(filter);

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // âœ… THEN (ê²°ê³¼ ê²€ì¦)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      expect(mockUserQueryService.findAllWithEmployee).toHaveBeenCalledWith(filter);
    });

    it('should apply multiple filters', async () => {
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ“¥ GIVEN (ì‚¬ì „ ì¡°ê±´ ì„¤ì •)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const filter = {
        name: 'í™',
        employeeNumber: 'EMP',
        status: EmployeeStatus.Active,
      };
      mockUserQueryService.findAllWithEmployee.mockResolvedValue([]);

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ¬ WHEN (í…ŒìŠ¤íŠ¸ ì‹¤í–‰)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      await controller.findAll(filter);

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // âœ… THEN (ê²°ê³¼ ê²€ì¦)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      expect(mockUserQueryService.findAllWithEmployee).toHaveBeenCalledWith(filter);
    });
  });

  /**
   * ğŸ“Œ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤: íŠ¹ì • User ì¡°íšŒ (Role í¬í•¨)
   *
   * ğŸ¯ ê²€ì¦ ëª©ì :
   *   GET /users/:id API ë™ì‘ ê²€ì¦
   *
   * âœ… ê¸°ëŒ€ ê²°ê³¼:
   *   Userì™€ Role ì •ë³´ ë°˜í™˜
   */
  describe('findById', () => {
    it('should return user with role', async () => {
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ“¥ GIVEN (ì‚¬ì „ ì¡°ê±´ ì„¤ì •)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const user = new User({
        id: 'user-123',
        roleId: 'role-456',
        isActive: true,
        createdAt: new Date(),
        updatedAt: new Date(),
      });
      const role = new Role({
        id: 'role-456',
        name: 'MANAGER',
        permissions: [
          new Permission({ id: 'p1', code: 'FILE_READ' }),
          new Permission({ id: 'p2', code: 'FILE_WRITE' }),
        ],
      });

      mockUserService.findByIdWithRole.mockResolvedValue({ user, role });

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ¬ WHEN (í…ŒìŠ¤íŠ¸ ì‹¤í–‰)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const result = await controller.findById('user-123');

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // âœ… THEN (ê²°ê³¼ ê²€ì¦)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      expect(mockUserService.findByIdWithRole).toHaveBeenCalledWith('user-123');
      expect(result.id).toBe('user-123');
      expect(result.role?.name).toBe('MANAGER');
      expect(result.role?.permissions).toContain('FILE_READ');
    });

    it('should return user without role when no role assigned', async () => {
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ“¥ GIVEN (ì‚¬ì „ ì¡°ê±´ ì„¤ì •)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const user = new User({
        id: 'user-123',
        roleId: null,
        isActive: true,
        createdAt: new Date(),
        updatedAt: new Date(),
      });

      mockUserService.findByIdWithRole.mockResolvedValue({ user, role: null });

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ¬ WHEN (í…ŒìŠ¤íŠ¸ ì‹¤í–‰)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const result = await controller.findById('user-123');

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // âœ… THEN (ê²°ê³¼ ê²€ì¦)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      expect(result.role).toBeNull();
    });
  });

  /**
   * ğŸ“Œ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤: Userì—ê²Œ Role ë¶€ì—¬
   *
   * ğŸ¯ ê²€ì¦ ëª©ì :
   *   PATCH /users/:id/role API ë™ì‘ ê²€ì¦
   *
   * âœ… ê¸°ëŒ€ ê²°ê³¼:
   *   Roleì´ ë¶€ì—¬ëœ User ë°˜í™˜
   */
  describe('assignRole', () => {
    it('should assign role to user', async () => {
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ“¥ GIVEN (ì‚¬ì „ ì¡°ê±´ ì„¤ì •)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const user = new User({
        id: 'user-123',
        roleId: 'role-456',
        isActive: true,
        createdAt: new Date(),
        updatedAt: new Date(),
      });

      mockUserService.assignRole.mockResolvedValue(user);

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ¬ WHEN (í…ŒìŠ¤íŠ¸ ì‹¤í–‰)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const result = await controller.assignRole('user-123', {
        roleId: 'role-456',
      });

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // âœ… THEN (ê²°ê³¼ ê²€ì¦)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      expect(mockUserService.assignRole).toHaveBeenCalledWith(
        'user-123',
        'role-456',
      );
      expect(result.roleId).toBe('role-456');
    });
  });

  /**
   * ğŸ“Œ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤: Userì˜ Role ì œê±°
   *
   * ğŸ¯ ê²€ì¦ ëª©ì :
   *   DELETE /users/:id/role API ë™ì‘ ê²€ì¦
   *
   * âœ… ê¸°ëŒ€ ê²°ê³¼:
   *   Roleì´ ì œê±°ëœ User ë°˜í™˜
   */
  describe('removeRole', () => {
    it('should remove role from user', async () => {
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ“¥ GIVEN (ì‚¬ì „ ì¡°ê±´ ì„¤ì •)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const user = new User({
        id: 'user-123',
        roleId: null,
        isActive: true,
        createdAt: new Date(),
        updatedAt: new Date(),
      });

      mockUserService.removeRole.mockResolvedValue(user);

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ¬ WHEN (í…ŒìŠ¤íŠ¸ ì‹¤í–‰)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const result = await controller.removeRole('user-123');

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // âœ… THEN (ê²°ê³¼ ê²€ì¦)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      expect(mockUserService.removeRole).toHaveBeenCalledWith('user-123');
      expect(result.roleId).toBeNull();
    });
  });

  /**
   * ğŸ“Œ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤: Employee â†’ User ë™ê¸°í™”
   *
   * ğŸ¯ ê²€ì¦ ëª©ì :
   *   POST /admin/users/sync API ë™ì‘ ê²€ì¦
   *
   * âœ… ê¸°ëŒ€ ê²°ê³¼:
   *   ë™ê¸°í™” ê²°ê³¼ ë°˜í™˜
   */
  describe('syncUsers', () => {
    it('should trigger user sync and return result', async () => {
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ“¥ GIVEN (ì‚¬ì „ ì¡°ê±´ ì„¤ì •)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const syncResult: SyncResult = {
        created: 5,
        activated: 2,
        deactivated: 1,
        skipped: 0,
        unchanged: 10,
        processingTimeMs: 150,
      };

      mockUserSyncService.syncEmployeesToUsers.mockResolvedValue(syncResult);

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ¬ WHEN (í…ŒìŠ¤íŠ¸ ì‹¤í–‰)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const result = await controller.syncUsers();

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // âœ… THEN (ê²°ê³¼ ê²€ì¦)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      expect(mockUserSyncService.syncEmployeesToUsers).toHaveBeenCalled();
      expect(result.created).toBe(5);
      expect(result.activated).toBe(2);
      expect(result.deactivated).toBe(1);
    });
  });
});
